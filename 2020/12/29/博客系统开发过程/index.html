<!DOCTYPE html>
<html lang="en">





<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="John Doe">
  <meta name="keywords" content="">
  <title>博客系统开发过程 - Hexo</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    <link  rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.0.0/styles/github-gist.min.css" />
  

  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_yg9cfy8wd6.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_pjno9b9zyxs.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script  src="/js/utils.js" ></script>
<meta name="generator" content="Hexo 4.2.1"></head>


<body>
  <header style="height: 100vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>Fhawke</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                Home
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                Archives
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                Categories
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                Tags
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                About
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="view intro-2" id="background" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="container text-center white-text fadeInUp">
            <span class="h2" id="subtitle">
              
            </span>

            
              
  <div class="mt-3 post-meta">
    <i class="iconfont icon-date-fill" aria-hidden="true"></i>
    <time datetime="2020-12-29 10:20">
      December 29, 2020 am
    </time>
  </div>


<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      17k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      290
       分钟
    </span>
  

  
  
</div>

            
          </div>

          
            <div class="scroll-down-bar">
              <i class="iconfont icon-arrowdown"></i>
            </div>
          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5" id="board">
          <div class="post-content mx-auto" id="post">
            
            <article class="markdown-body">
              <h1 id="博客系统开发流程"><a href="#博客系统开发流程" class="headerlink" title="博客系统开发流程"></a>博客系统开发流程</h1><h2 id="1-框架搭建"><a href="#1-框架搭建" class="headerlink" title="1. 框架搭建"></a>1. 框架搭建</h2><ul>
<li><p>使用SpringBoot搭建，编写配置文件</p>
</li>
<li><p>yml文件配置-application.yml</p>
</li>
<li><pre><code>spring:
  thymeleaf:
    mode: HTML
  profiles:
    active: pro

</code></pre></li>
</ul>
<p>  mybatis:<br>    type-aliases-package: com.star.entity<br>    mapper-locations: classpath:mapper/*.xml<br>    configuration:<br>      map-underscore-to-camel-case: true<br>  <pre><code class="hljs diff">
<span class="hljs-deletion">- application-dev.yml</span>

<span class="hljs-deletion">-</span></code></pre><br>  spring:<br>    datasource:<br>      driver-class-name: com.mysql.cj.jdbc.Driver<br>      url: jdbc:mysql://localhost:3306/myblog?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false&amp;serverTimezone=UTC<br>      username: root<br>      password: 123456</p>
<p>  logging:<br>    level:<br>      root: info<br>      com.star: debug<br>    file:<br>      name: log/blog-dev.log<br>  <pre><code class="hljs css">
<span class="hljs-selector-tag">-</span> <span class="hljs-selector-tag">application</span><span class="hljs-selector-class">.pro</span><span class="hljs-selector-class">.yml</span>

<span class="hljs-selector-tag">-</span></code></pre><br>  spring:<br>    datasource:<br>      driver-class-name: com.mysql.cj.jdbc.Driver<br>      url: jdbc:mysql://localhost:3306/myblog?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false&amp;serverTimezone=UTC&amp;serverTimezone=GMT%2B8<br>      username: root<br>      password: 123456</p>
<p>  logging:<br>    level:<br>      root: warn<br>      com.star: info<br>    file:<br>      name: log/blog-pro.log<br>  <pre><code class="hljs dust">
<span class="xml">**公共部分application.yml配置了thymeleaf模板，当前配置文件，数据库持久层配置(mapper)，开发环境和部署环境配置了数据库和日志**</span>

<span class="xml">- logback-spring.xml配置（重写SpringBoot默认日志配置）</span>

<span class="xml">- ```xml</span>
<span class="xml">  <span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span>
<span class="xml">  <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span></span>
<span class="xml">      <span class="hljs-comment">&lt;!--包含Spring boot对logback日志的默认配置--&gt;</span></span>
<span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">include</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">"org/springframework/boot/logging/logback/defaults.xml"</span> /&gt;</span></span>
<span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"LOG_FILE"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"$</span></span></span><span class="hljs-template-variable">&#123;LOG_FILE:-$&#123;LOG_PATH:-$&#123;LOG_TEMP:-$&#123;java.io.tmpdir:-/tmp&#125;</span><span class="xml"><span class="hljs-tag"><span class="hljs-string">&#125;&#125;/spring.log&#125;"</span>/&gt;</span></span>
<span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">include</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">"org/springframework/boot/logging/logback/console-appender.xml"</span> /&gt;</span></span>
<span class="xml">  </span>
<span class="xml">      <span class="hljs-comment">&lt;!--重写了Spring Boot框架 org/springframework/boot/logging/logback/file-appender.xml 配置--&gt;</span></span>
<span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"TIME_FILE"</span></span></span>
<span class="xml">                class="ch.qos.logback.core.rolling.RollingFileAppender"&gt;</span>
<span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">encoder</span>&gt;</span></span>
<span class="xml">              <span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>$</span><span class="hljs-template-variable">&#123;FILE_LOG_PATTERN&#125;</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span></span>
<span class="xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">encoder</span>&gt;</span></span>
<span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">file</span>&gt;</span>$</span><span class="hljs-template-variable">&#123;LOG_FILE&#125;</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">file</span>&gt;</span></span>
<span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">rollingPolicy</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ch.qos.logback.core.rolling.TimeBasedRollingPolicy"</span>&gt;</span></span>
<span class="xml">              <span class="hljs-tag">&lt;<span class="hljs-name">fileNamePattern</span>&gt;</span>$</span><span class="hljs-template-variable">&#123;LOG_FILE&#125;</span><span class="xml">.%d</span><span class="hljs-template-variable">&#123;yyyy-MM-dd&#125;</span><span class="xml">.%i<span class="hljs-tag">&lt;/<span class="hljs-name">fileNamePattern</span>&gt;</span></span>
<span class="xml">              <span class="hljs-comment">&lt;!--保留历史日志一个月的时间--&gt;</span></span>
<span class="xml">              <span class="hljs-tag">&lt;<span class="hljs-name">maxHistory</span>&gt;</span>30<span class="hljs-tag">&lt;/<span class="hljs-name">maxHistory</span>&gt;</span></span>
<span class="xml">              <span class="hljs-comment">&lt;!--</span></span>
<span class="xml">              Spring Boot默认情况下，日志文件10M时，会切分日志文件,这样设置日志文件会在100M时切分日志</span>
<span class="xml">              --&gt;</span>
<span class="xml">              <span class="hljs-tag">&lt;<span class="hljs-name">timeBasedFileNamingAndTriggeringPolicy</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP"</span>&gt;</span></span>
<span class="xml">                  <span class="hljs-tag">&lt;<span class="hljs-name">maxFileSize</span>&gt;</span>10MB<span class="hljs-tag">&lt;/<span class="hljs-name">maxFileSize</span>&gt;</span></span>
<span class="xml">              <span class="hljs-tag">&lt;/<span class="hljs-name">timeBasedFileNamingAndTriggeringPolicy</span>&gt;</span></span>
<span class="xml">  </span>
<span class="xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">rollingPolicy</span>&gt;</span></span>
<span class="xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span></span>
<span class="xml">  </span>
<span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">root</span> <span class="hljs-attr">level</span>=<span class="hljs-string">"INFO"</span>&gt;</span></span>
<span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"CONSOLE"</span> /&gt;</span></span>
<span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"TIME_FILE"</span> /&gt;</span></span>
<span class="xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span></span>
<span class="xml">  </span>
<span class="xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span></span>
<span class="xml">          <span class="hljs-comment">&lt;!--</span></span>
<span class="xml">              1、继承Spring boot logback设置（可以在appliaction.yml或者application.properties设置logging.*属性）</span>
<span class="xml">              2、重写了默认配置，设置日志文件大小在10MB时，按日期切分日志</span>
<span class="xml">          --&gt;</span></code></pre></p>
<p><code>spring.profiles.active=dev</code> 使用参数指定SpringBoot启动</p>
<h3 id="PageHelper配置模板"><a href="#PageHelper配置模板" class="headerlink" title="PageHelper配置模板"></a>PageHelper配置模板</h3><pre><code class="hljs java"><span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/pictures"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">pictures</span><span class="hljs-params">(Model model, @RequestParam(defaultValue = <span class="hljs-string">"1"</span>,value = <span class="hljs-string">"pageNum"</span>)</span>Integer pageNum)</span>&#123;
    PageHelper.startPage(pageNum,<span class="hljs-number">10</span>);
    List&lt;Picture&gt; pictureList = pictureService.listPicture();
    PageInfo&lt;Picture&gt; pageInfo = <span class="hljs-keyword">new</span> PageInfo&lt;&gt;(pictureList);
    model.addAttribute(<span class="hljs-string">"pageInfo"</span>,pageInfo);
    <span class="hljs-keyword">return</span> <span class="hljs-string">"admin/pictures"</span>;
&#125;</code></pre>







<h2 id="2-异常处理"><a href="#2-异常处理" class="headerlink" title="2. 异常处理"></a>2. 异常处理</h2><p>在页面访问时候需要错误页面，以及出现错误跳转到错误页面的处理</p>
<ul>
<li>404.html</li>
<li>500.html</li>
<li>error.html</li>
</ul>
<p><strong>全局异常处理</strong></p>
<p>对于404和500界面，出现错误进行捕捉，自定义的错误我们需要自己拦截，定义一个类来捕捉，通过这个类来拦截所有的异常</p>
<pre><code class="hljs java"><span class="hljs-keyword">package</span> com.star.hander;


<span class="hljs-keyword">import</span> org.slf4j.Logger;
<span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;
<span class="hljs-keyword">import</span> org.springframework.core.annotation.AnnotationUtils;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.ControllerAdvice;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.ExceptionHandler;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.ResponseStatus;
<span class="hljs-keyword">import</span> org.springframework.web.servlet.ModelAndView;

<span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;
<span class="hljs-comment">//拦截所有带controller注解的控制器</span>
<span class="hljs-meta">@ControllerAdvice</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ControllerExceptionHandler</span> </span>&#123;

    <span class="hljs-comment">//日志记录异常</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Logger logger = LoggerFactory.getLogger(<span class="hljs-keyword">this</span>.getClass());
    <span class="hljs-comment">//异常处理方法</span>

    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@Descripion</span> 处理错误信息（全局异常处理）</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@Author</span> lsh</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> request : 访问的异常URL</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> e : 异常参数</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@return</span>  返回错误信息页面</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> Exception</span>
<span class="hljs-comment">     */</span>
    <span class="hljs-meta">@ExceptionHandler</span>(Exception<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>
<span class="hljs-class">    <span class="hljs-title">public</span> <span class="hljs-title">ModelAndView</span> <span class="hljs-title">exceptionHandler</span>(<span class="hljs-title">HttpServletRequest</span> <span class="hljs-title">request</span>,<span class="hljs-title">Exception</span> <span class="hljs-title">e</span>) <span class="hljs-title">throws</span> <span class="hljs-title">Exception</span></span>&#123;

        <span class="hljs-comment">//记录异常信息</span>
        logger.error(<span class="hljs-string">"Request URL : &#123;&#125;,Exception : &#123;&#125;"</span>,request.getRequestURL(),e);

        <span class="hljs-comment">//当标识了状态码的时候就不拦截</span>
        <span class="hljs-keyword">if</span>(AnnotationUtils.findAnnotation(e.getClass(), ResponseStatus<span class="hljs-class">.<span class="hljs-keyword">class</span>)!</span>=<span class="hljs-keyword">null</span>)&#123;
            <span class="hljs-keyword">throw</span> e;
        &#125;

        <span class="hljs-comment">//返回记录的异常信息</span>
        ModelAndView mv = <span class="hljs-keyword">new</span> ModelAndView();
        mv.addObject(<span class="hljs-string">"url"</span>,request.getRequestURL());
        mv.addObject(<span class="hljs-string">"exception"</span>,e);
        <span class="hljs-comment">//跳转到error包下的error界面</span>
        mv.setViewName(<span class="hljs-string">"error/error"</span>);
        <span class="hljs-keyword">return</span> mv;
    &#125;
&#125;</code></pre>



<ul>
<li><p>对于资源找不到的类，作异常处理</p>
</li>
<li><pre><code class="java"><span class="keyword">package</span> com.star;

<span class="keyword">import</span> org.springframework.http.HttpStatus;
<span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseStatus;

<span class="comment">/**</span>
<span class="comment"> * 自定义异常</span>
<span class="comment"> * <span class="doctag">@ResponseStatus</span>(HttpStatus.NOT_FOUND) 注解表示资源找不到的状态码，标识了状态码的时候就不拦截</span>
<span class="comment"> */</span>
<span class="meta">@ResponseStatus</span>(HttpStatus.NOT_FOUND)
<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NotFoundException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span></span>{
    <span class="function"><span class="keyword">public</span> <span class="title">NotFoundException</span><span class="params">()</span> </span>{
    }

    <span class="function"><span class="keyword">public</span> <span class="title">NotFoundException</span><span class="params">(String message)</span> </span>{
        <span class="keyword">super</span>(message);
    }

    <span class="function"><span class="keyword">public</span> <span class="title">NotFoundException</span><span class="params">(String message, Throwable cause)</span> </span>{
        <span class="keyword">super</span>(message, cause);
    }
}
&lt;!--￼<span class="number">5</span>--&gt;</code></pre>
</li>
<li><p>切面处理</p>
</li>
<li><pre><code class="java"><span class="keyword">package</span> com.star.aspect;

<span class="keyword">import</span> org.aspectj.lang.JoinPoint;
<span class="keyword">import</span> org.aspectj.lang.annotation.*;
<span class="keyword">import</span> org.slf4j.Logger;
<span class="keyword">import</span> org.slf4j.LoggerFactory;
<span class="keyword">import</span> org.springframework.stereotype.Component;
<span class="keyword">import</span> org.springframework.web.context.request.RequestContextHolder;
<span class="keyword">import</span> org.springframework.web.context.request.ServletRequestAttributes;

<span class="keyword">import</span> javax.servlet.http.HttpServletRequest;
<span class="keyword">import</span> java.util.Arrays;

<span class="comment">/**</span>
<span class="comment"> * <span class="doctag">@Pointcut</span>("execution(* com.star.controller..(..))")：定义切面，声明log()是一个切面，通过execution来表示需要拦截的类，</span>
<span class="comment"> * 这里表示拦截控制器下面的所有类所有方法</span>
<span class="comment"> * 在访问页面（controller）之前，拦截请求的URL、IP、调用的方法、传递的参数、返回的内容，并记录到日志</span>
<span class="comment"> */</span>
<span class="meta">@Aspect</span>
<span class="meta">@Component</span>
<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogAspect</span> </span>{
    <span class="comment">//获取日志信息</span>
    <span class="keyword">private</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(<span class="keyword">this</span>.getClass());

    <span class="comment">//定义切面</span>
    <span class="meta">@Pointcut</span>(<span class="string">"execution(* com.star.controller.*.*(..))"</span>)
    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">log</span><span class="params">()</span></span>{}

    <span class="comment">//在切面之前执行</span>
    <span class="meta">@Before</span>(<span class="string">"log()"</span>)
    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doBefore</span><span class="params">(JoinPoint joinPoint)</span></span>{
        ServletRequestAttributes attributes = (ServletRequestAttributes) RequestContextHolder.getRequestAttributes();
        HttpServletRequest request = attributes.getRequest();

        <span class="comment">//获取URL，IP</span>
        String url = request.getRequestURL().toString();
        String ip =  request.getRemoteAddr();

        <span class="comment">//获取请求方法</span>
        String classMethod = joinPoint.getSignature().getDeclaringTypeName() + <span class="string">"."</span> + joinPoint.getSignature().getName();

        <span class="comment">//获取请求参数</span>
        Object[] args = joinPoint.getArgs();
        RequestLog requestLog = <span class="keyword">new</span> RequestLog(url,ip,classMethod,args);
        logger.info(<span class="string">"Request : {}"</span>,requestLog);
    }

</code></pre>
</li>
</ul>
<pre><code>//在切面之后执行
@After(&quot;log()&quot;)
public void doAfter(){
    logger.info(&quot;----doAfter----&quot;);
}


//返回之后拦截
@AfterReturning(returning = &quot;result&quot;,pointcut = &quot;log()&quot;)
public void doAfterReturn(Object result){
    logger.info(&quot;Result : {}&quot;,result);
}

//封装请求参数
private class RequestLog{
    private String url;
    private String ip;
    private String classMethod;
    private Object[] args;

    public RequestLog(String url, String ip, String classMethod, Object[] args) {
        this.url = url;
        this.ip = ip;
        this.classMethod = classMethod;
        this.args = args;
    }

    @Override
    public String toString() {
        return &quot;RequestLog{&quot; +
                &quot;url=&apos;&quot; + url + &apos;\&apos;&apos; +
                &quot;, ip=&apos;&quot; + ip + &apos;\&apos;&apos; +
                &quot;, classMethod=&apos;&quot; + classMethod + &apos;\&apos;&apos; +
                &quot;, args=&quot; + Arrays.toString(args) +
                &apos;}&apos;;
    }
}</code></pre><p>  }<br>  <pre><code class="hljs">


## 4. 登陆功能

- 首先定义用户实体类

- ```java
  package com.star.entity;
  
  import lombok.AllArgsConstructor;
  import lombok.Getter;
  import lombok.NoArgsConstructor;
  import lombok.Setter;
  
  import java.util.Date;
  
  /**
   * 用户实体类
   * - 昵称
   * - 用户名
   * - 密码
   * - 邮箱
   * - 类型
   * - 头像
   * - 创建时间
   * - 更新时间
   */
  @Getter
  @Setter
  @NoArgsConstructor
  @AllArgsConstructor
  public class User &#123;
      private Long id;
      private String nickname;
      private String username;
      private String password;
      private String email;
      private String avatar;
      private Integer type;
      private Date createTime;
      private Date updateTime;
  &#125;</code></pre></p>
<ul>
<li><p>定义MD5加密，思路是将明文密码通过MD5加密存储到数据库，在校验的时候通过输入的密码进行MD5再次加密，和数据库的密码比对</p>
</li>
<li><pre><code class="java"><span class="keyword">package</span> com.star.util;

</code></pre>
</li>
</ul>
<p>  import java.security.MessageDigest;<br>  import java.security.NoSuchAlgorithmException;</p>
<p>  /**</p>
<ul>
<li><p>MD5加密工具类</p>
</li>
<li><p>/<br>public class MD5Utils {</p>
<p>  /**</p>
<ul>
<li><p>@Description: MD5加密</p>
</li>
<li><p>@Auther: ONESTAR</p>
</li>
<li><p>@Date: 17:19 2020/5/27</p>
</li>
<li><p>@Param: 要加密的字符串</p>
</li>
<li><p>@Return: 加密后的字符串</p>
</li>
<li><p>/<br>public static String code(String str){<br>  try {</p>
<pre><code>MessageDigest md = MessageDigest.getInstance(&quot;MD5&quot;);
md.update(str.getBytes());
byte[]byteDigest = md.digest();
int i;
StringBuffer buf = new StringBuffer(&quot;&quot;);
for (int offset = 0; offset &lt; byteDigest.length; offset++) {
    i = byteDigest[offset];
    if (i &lt; 0)
        i += 256;
    if (i &lt; 16)
        buf.append(&quot;0&quot;);
    buf.append(Integer.toHexString(i));
}
//32位加密
return buf.toString();
// 16位的加密
//return buf.toString().substring(8, 24);</code></pre><p>  } catch (NoSuchAlgorithmException e) {</p>
<pre><code>e.printStackTrace();
return null;</code></pre><p>  }</p>
<p>}</p>
<p>//根据明文输出密码<br>public static void main(String[] args) {<br>  System.out.println(code(“123456”));<br>}</p>
</li>
</ul>
<p>}</p>
<pre><code class="hljs">


- 建立持久层接口

- ```java
  package com.star.dao;
  
  import com.star.entity.User;
  import org.apache.ibatis.annotations.Mapper;
  import org.apache.ibatis.annotations.Param;
  import org.springframework.stereotype.Repository;
  
  @Mapper
  @Repository
  public interface UserDao &#123;
      /**
       * @param 定义下个属性的别名，在xml中直接可以用 username = #&#123;username&#125; 来进行判断
       * @param username  用户名
       * @param password  密码
       * @return  返回用户对象
       */
      User findByUsernameAndPassword(@Param("username") String username,@Param("password") String password);
  &#125;</code></pre>

</li>
</ul>
<ul>
<li><p>mapper.xml文件</p>
</li>
<li><pre><code class="xml"><span class="meta">&lt;?xml version="1.0" encoding="utf-8" ?&gt;</span>
<span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span> <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span> &gt;</span>
<span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.star.dao.UserDao"</span>&gt;</span>
    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findByUsernameAndPassword"</span> <span class="attr">resultType</span>=<span class="string">"com.star.entity.User"</span>&gt;</span>
        select * from myblog.t_user
        where username = #{username} and password = #{password};
    <span class="tag">&lt;/<span class="name">select</span>&gt;</span>
<span class="tag">&lt;/<span class="name">mapper</span>&gt;</span>
<span class="comment"><pre><code class="hljs haxe">
- Service层及SerivceImpl

- ```java
  <span class="hljs-keyword">package</span> com.star.service;
  
  <span class="hljs-keyword">import</span> com.star.entity.User;
  
  <span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserService</span> </span>&#123;
      <span class="hljs-comment">//核对用户名和密码</span>
      User checkUser(<span class="hljs-keyword">String</span> username,<span class="hljs-keyword">String</span> password);
  &#125;</code></pre></span></code></pre>
</li>
<li><pre><code class="java"><span class="keyword">package</span> com.star.service.impl;

<span class="keyword">import</span> com.star.dao.UserDao;
<span class="keyword">import</span> com.star.entity.User;
<span class="keyword">import</span> com.star.service.UserService;
<span class="keyword">import</span> com.star.util.MD5Utils;
<span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="keyword">import</span> org.springframework.stereotype.Service;

<span class="meta">@Service</span>
<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>{
    <span class="meta">@Autowired</span>
    <span class="keyword">private</span> UserDao userDao;

    <span class="meta">@Override</span>
    <span class="function"><span class="keyword">public</span> User <span class="title">checkUser</span><span class="params">(String username, String password)</span> </span>{
        User user = userDao.findByUsernameAndPassword(username, MD5Utils.code(password));
        <span class="keyword">return</span> user;
    }
}
&lt;!--￼<span class="number">9</span>--&gt;</code></pre>
</li>
<li><p>登陆拦截器</p>
</li>
<li><p>在没有登陆的情况下不能让客户访问到后台管理页面，所以添加一个登陆拦截器，将访问路径过滤，使用SpringBoot内置的interceptor</p>
</li>
<li><pre><code class="java"><span class="keyword">package</span> com.star.interceptor;

<span class="keyword">import</span> org.springframework.web.servlet.handler.HandlerInterceptorAdapter;

<span class="keyword">import</span> javax.servlet.http.HttpServletRequest;
<span class="keyword">import</span> javax.servlet.http.HttpServletResponse;
<span class="comment">/**</span>
<span class="comment"> * <span class="doctag">@Description</span>: 登录过滤拦截</span>
<span class="comment"> */</span>
<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginInterceptor</span> <span class="keyword">extends</span> <span class="title">HandlerInterceptorAdapter</span> </span>{
    <span class="meta">@Override</span>
    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>{
        <span class="keyword">if</span>(request.getSession().getAttribute(<span class="string">"user"</span>)==<span class="keyword">null</span>){
            response.sendRedirect(<span class="string">"/admin"</span>);
            <span class="keyword">return</span> <span class="keyword">false</span>;
        }
        <span class="keyword">return</span> <span class="keyword">true</span>;
    }
}
&lt;!--￼<span class="number">10</span>--&gt;</code></pre>
</li>
<li><p>通过前端的表单传入参数  (<code>th:action=&quot;@{/admin/login}&quot;</code> 表示动作，将参数传入页面，通过后端校验) </p>
</li>
</ul>
<pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ui large form"</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"post"</span> <span class="hljs-attr">action</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">th:action</span>=<span class="hljs-string">"@&#123;/admin/login&#125;"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ui  segment"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"field"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ui left icon input"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"user icon"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"username"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"用户名"</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"field"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ui left icon input"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"lock icon"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"password"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"password"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"密码"</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ui fluid large teal submit button"</span>&gt;</span>登   录<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ui error mini message"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ui mini negative message"</span> &gt;</span>用户名和密码错误<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></code></pre>



<h2 id="5-实体类构建"><a href="#5-实体类构建" class="headerlink" title="5. 实体类构建"></a>5. 实体类构建</h2><ul>
<li>直接上代码了，没有什么好说的</li>
</ul>
<pre><code class="hljs java"><span class="hljs-keyword">package</span> com.star.entity;

<span class="hljs-keyword">import</span> lombok.AllArgsConstructor;
<span class="hljs-keyword">import</span> lombok.Getter;
<span class="hljs-keyword">import</span> lombok.NoArgsConstructor;
<span class="hljs-keyword">import</span> lombok.Setter;

<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.Date;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-comment">/**</span>
<span class="hljs-comment"> * 博客实体类，和评论一对多关系</span>
<span class="hljs-comment"> */</span>
<span class="hljs-meta">@AllArgsConstructor</span>
<span class="hljs-meta">@NoArgsConstructor</span>
<span class="hljs-meta">@Getter</span>
<span class="hljs-meta">@Setter</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Blog</span> </span>&#123;
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String title;
    <span class="hljs-keyword">private</span> String content;
    <span class="hljs-keyword">private</span> String firstPicture;
    <span class="hljs-keyword">private</span> String flag;
    <span class="hljs-keyword">private</span> Integer views;
    <span class="hljs-keyword">private</span> Integer commentCount;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> appreciation;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> shareStatement;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> commentabled;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> published;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> recommend;
    <span class="hljs-keyword">private</span> Date createTime;
    <span class="hljs-keyword">private</span> Date updateTime;
    <span class="hljs-keyword">private</span> String description;

    <span class="hljs-keyword">private</span> Type type;
    <span class="hljs-keyword">private</span> User user;
    <span class="hljs-keyword">private</span> Long typeId;
    <span class="hljs-keyword">private</span> Long userId;
    <span class="hljs-keyword">private</span> List&lt;Comment&gt; comments = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();
&#125;</code></pre>

<pre><code class="hljs java"><span class="hljs-keyword">package</span> com.star.entity;

<span class="hljs-keyword">import</span> lombok.AllArgsConstructor;
<span class="hljs-keyword">import</span> lombok.Getter;
<span class="hljs-keyword">import</span> lombok.NoArgsConstructor;
<span class="hljs-keyword">import</span> lombok.Setter;

<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.Date;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-comment">/**</span>
<span class="hljs-comment"> * 评论实体类，和子评论一对多</span>
<span class="hljs-comment"> */</span>
<span class="hljs-meta">@AllArgsConstructor</span>
<span class="hljs-meta">@NoArgsConstructor</span>
<span class="hljs-meta">@Getter</span>
<span class="hljs-meta">@Setter</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Comment</span> </span>&#123;
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String nickname;
    <span class="hljs-keyword">private</span> String email;
    <span class="hljs-keyword">private</span> String content;
    <span class="hljs-keyword">private</span> String avatar;
    <span class="hljs-keyword">private</span> Date createTime;
    <span class="hljs-keyword">private</span> Long blogId;
    <span class="hljs-keyword">private</span> Long parentCommentId;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> adminComment;

    <span class="hljs-comment">//回复评论</span>
    <span class="hljs-keyword">private</span> List&lt;Comment&gt; replyComments = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();
    <span class="hljs-keyword">private</span> Comment ParentComment;
    <span class="hljs-keyword">private</span> String parentNickname;
&#125;</code></pre>

<pre><code class="hljs java"><span class="hljs-keyword">package</span> com.star.entity;

<span class="hljs-keyword">import</span> lombok.AllArgsConstructor;
<span class="hljs-keyword">import</span> lombok.Getter;
<span class="hljs-keyword">import</span> lombok.NoArgsConstructor;
<span class="hljs-keyword">import</span> lombok.Setter;

<span class="hljs-keyword">import</span> java.util.Date;

<span class="hljs-comment">/**</span>
<span class="hljs-comment"> * 友情链接实体类</span>
<span class="hljs-comment"> */</span>
<span class="hljs-meta">@AllArgsConstructor</span>
<span class="hljs-meta">@NoArgsConstructor</span>
<span class="hljs-meta">@Getter</span>
<span class="hljs-meta">@Setter</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FriendLink</span> </span>&#123;
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String blogname;
    <span class="hljs-keyword">private</span> String blogaddress;
    <span class="hljs-keyword">private</span> String pictureaddress;
    <span class="hljs-keyword">private</span> Date createTime;
&#125;</code></pre>

<pre><code class="hljs java"><span class="hljs-keyword">package</span> com.star.entity;

<span class="hljs-keyword">import</span> lombok.AllArgsConstructor;
<span class="hljs-keyword">import</span> lombok.Getter;
<span class="hljs-keyword">import</span> lombok.NoArgsConstructor;
<span class="hljs-keyword">import</span> lombok.Setter;

<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.Date;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-comment">/**</span>
<span class="hljs-comment"> * 留言实体类，和回复留言一对多</span>
<span class="hljs-comment"> */</span>
<span class="hljs-meta">@AllArgsConstructor</span>
<span class="hljs-meta">@NoArgsConstructor</span>
<span class="hljs-meta">@Getter</span>
<span class="hljs-meta">@Setter</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Message</span> </span>&#123;
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String nickname;
    <span class="hljs-keyword">private</span> String email;
    <span class="hljs-keyword">private</span> String content;
    <span class="hljs-keyword">private</span> String avatar;
    <span class="hljs-keyword">private</span> Date createTime;
    <span class="hljs-keyword">private</span> Long parentMessageId;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> adminMessage;

    <span class="hljs-comment">//回复留言</span>
    <span class="hljs-keyword">private</span> List&lt;Message&gt; replyMessages = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();
    <span class="hljs-keyword">private</span> Message parentMessage;
    <span class="hljs-keyword">private</span> String parentNickname;
&#125;</code></pre>

<pre><code class="hljs java"><span class="hljs-keyword">package</span> com.star.entity;

<span class="hljs-keyword">import</span> lombok.AllArgsConstructor;
<span class="hljs-keyword">import</span> lombok.Getter;
<span class="hljs-keyword">import</span> lombok.NoArgsConstructor;
<span class="hljs-keyword">import</span> lombok.Setter;

<span class="hljs-comment">/**</span>
<span class="hljs-comment"> * 相册实体类</span>
<span class="hljs-comment"> */</span>
<span class="hljs-meta">@AllArgsConstructor</span>
<span class="hljs-meta">@NoArgsConstructor</span>
<span class="hljs-meta">@Getter</span>
<span class="hljs-meta">@Setter</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Picture</span> </span>&#123;
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String picturename;
    <span class="hljs-keyword">private</span> String picturetime;
    <span class="hljs-keyword">private</span> String pictureaddress;
    <span class="hljs-keyword">private</span> String picturedescription;
&#125;</code></pre>

<pre><code class="hljs java"><span class="hljs-keyword">package</span> com.star.entity;

<span class="hljs-keyword">import</span> lombok.AllArgsConstructor;
<span class="hljs-keyword">import</span> lombok.Getter;
<span class="hljs-keyword">import</span> lombok.NoArgsConstructor;
<span class="hljs-keyword">import</span> lombok.Setter;

<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-comment">/**</span>
<span class="hljs-comment"> * 分类实体类，和博客一对多</span>
<span class="hljs-comment"> */</span>
<span class="hljs-meta">@AllArgsConstructor</span>
<span class="hljs-meta">@NoArgsConstructor</span>
<span class="hljs-meta">@Getter</span>
<span class="hljs-meta">@Setter</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Type</span> </span>&#123;
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> List&lt;Blog&gt; blogs = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();
&#125;</code></pre>

<pre><code class="hljs java"><span class="hljs-keyword">package</span> com.star.entity;

<span class="hljs-keyword">import</span> lombok.AllArgsConstructor;
<span class="hljs-keyword">import</span> lombok.Getter;
<span class="hljs-keyword">import</span> lombok.NoArgsConstructor;
<span class="hljs-keyword">import</span> lombok.Setter;

<span class="hljs-keyword">import</span> java.util.Date;

<span class="hljs-comment">/**</span>
<span class="hljs-comment"> * 用户实体类</span>
<span class="hljs-comment"> * - 昵称</span>
<span class="hljs-comment"> * - 用户名</span>
<span class="hljs-comment"> * - 密码</span>
<span class="hljs-comment"> * - 邮箱</span>
<span class="hljs-comment"> * - 类型</span>
<span class="hljs-comment"> * - 头像</span>
<span class="hljs-comment"> * - 创建时间</span>
<span class="hljs-comment"> * - 更新时间</span>
<span class="hljs-comment"> */</span>
<span class="hljs-meta">@Getter</span>
<span class="hljs-meta">@Setter</span>
<span class="hljs-meta">@NoArgsConstructor</span>
<span class="hljs-meta">@AllArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>&#123;
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String nickname;
    <span class="hljs-keyword">private</span> String username;
    <span class="hljs-keyword">private</span> String password;
    <span class="hljs-keyword">private</span> String email;
    <span class="hljs-keyword">private</span> String avatar;
    <span class="hljs-keyword">private</span> Integer type;
    <span class="hljs-keyword">private</span> Date createTime;
    <span class="hljs-keyword">private</span> Date updateTime;
&#125;</code></pre>





<h2 id="6-分类管理"><a href="#6-分类管理" class="headerlink" title="6. 分类管理"></a>6. 分类管理</h2><h3 id="1-持久层接口"><a href="#1-持久层接口" class="headerlink" title="1. 持久层接口"></a>1. 持久层接口</h3><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.star.dao;


<span class="hljs-keyword">import</span> com.star.entity.Type;
<span class="hljs-keyword">import</span> org.apache.ibatis.annotations.Mapper;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Repository;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-meta">@Mapper</span>
<span class="hljs-meta">@Repository</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">TypeDao</span> </span>&#123;

    <span class="hljs-comment">//新增保存分类</span>
    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">saveType</span><span class="hljs-params">(Type type)</span></span>;

    <span class="hljs-comment">//根据id查询分类</span>
    <span class="hljs-function">Type <span class="hljs-title">getType</span><span class="hljs-params">(Long id)</span></span>;
    <span class="hljs-comment">//查询所有分类</span>
    <span class="hljs-function">List&lt;Type&gt; <span class="hljs-title">getAllType</span><span class="hljs-params">()</span></span>;
    <span class="hljs-comment">//根据分类名称查询分类</span>
    <span class="hljs-function">Type <span class="hljs-title">getTypeByName</span><span class="hljs-params">(String name)</span></span>;
    <span class="hljs-comment">//编辑修改分类</span>
    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">updateType</span><span class="hljs-params">(Type type)</span></span>;
    <span class="hljs-comment">//删除分类</span>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">deleteType</span><span class="hljs-params">(Long id)</span></span>;&#125;</code></pre>

<h3 id="2-mapper文件"><a href="#2-mapper文件" class="headerlink" title="2. mapper文件"></a>2. mapper文件</h3><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8" ?&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">mapper</span> <span class="hljs-meta-keyword">PUBLIC</span> <span class="hljs-meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span> <span class="hljs-meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span> &gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">"com.star.dao.TypeDao"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 新增保存分类 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"saveType"</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">"com.star.entity.Type"</span>&gt;</span>
        insert into myblog.t_type values(#&#123;id&#125;,#&#123;name&#125;);
    <span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 根据id查询分类 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"getType"</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">"com.star.entity.Type"</span>&gt;</span>
        select id,name from myblog.t_type where id = #&#123;id&#125;;
    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 查询所有分类 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"getAllType"</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">"com.star.entity.Type"</span>&gt;</span>
        select * from myblog.t_type;
    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 根据分类名字查询 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"getTypeByName"</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">"com.star.entity.Type"</span>&gt;</span>
        select * from myblog.t_type where name = #&#123;name&#125;;
    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 编辑修改分类 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">update</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"updateType"</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">"com.star.entity.Type"</span>&gt;</span>
        update myblog.t_type set name = #&#123;name&#125; where id = #&#123;id&#125;;
    <span class="hljs-tag">&lt;/<span class="hljs-name">update</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 删除分类 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">delete</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"deleteType"</span>&gt;</span>
        delete from myblog.t_type where id = #&#123;id&#125;;
    <span class="hljs-tag">&lt;/<span class="hljs-name">delete</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span></code></pre>

<h3 id="3-service层及Impl"><a href="#3-service层及Impl" class="headerlink" title="3. service层及Impl"></a>3. service层及Impl</h3><ul>
<li>对应mapper文件的方法</li>
<li>@Transactional注解： 实现事务操作</li>
</ul>
<pre><code class="hljs java"><span class="hljs-keyword">package</span> com.star.service.impl;

<span class="hljs-keyword">import</span> com.star.dao.TypeDao;
<span class="hljs-keyword">import</span> com.star.entity.Type;
<span class="hljs-keyword">import</span> com.star.service.TypeService;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;
<span class="hljs-keyword">import</span> org.springframework.transaction.annotation.Transactional;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-comment">/**</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@Transactional</span>注解： 实现事务操作</span>
<span class="hljs-comment"> */</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TypeServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">TypeService</span> </span>&#123;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> TypeDao typeDao;
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">saveType</span><span class="hljs-params">(Type type)</span> </span>&#123;
        <span class="hljs-keyword">return</span> typeDao.saveType(type);
    &#125;
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Type <span class="hljs-title">getType</span><span class="hljs-params">(Long id)</span> </span>&#123;
        <span class="hljs-keyword">return</span> typeDao.getType(id);
    &#125;
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Type&gt; <span class="hljs-title">getAllType</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> typeDao.getAllType();
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Type <span class="hljs-title">getTypeByName</span><span class="hljs-params">(String name)</span> </span>&#123;
        <span class="hljs-keyword">return</span> typeDao.getTypeByName(name);
    &#125;
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">updateType</span><span class="hljs-params">(Type type)</span> </span>&#123;
        <span class="hljs-keyword">return</span> typeDao.updateType(type);
    &#125;
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">deleteType</span><span class="hljs-params">(Long id)</span> </span>&#123;
        typeDao.deleteType(id);
    &#125;
&#125;</code></pre>

<pre><code class="hljs java"><span class="hljs-keyword">package</span> com.star.service;

<span class="hljs-keyword">import</span> com.star.entity.Type;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">TypeService</span> </span>&#123;
    <span class="hljs-comment">//新增保存分类</span>
    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">saveType</span><span class="hljs-params">(Type type)</span></span>;

    <span class="hljs-comment">//根据id查询分类</span>
    <span class="hljs-function">Type <span class="hljs-title">getType</span><span class="hljs-params">(Long id)</span></span>;

    <span class="hljs-comment">//查询所有分类</span>
    <span class="hljs-function">List&lt;Type&gt; <span class="hljs-title">getAllType</span><span class="hljs-params">()</span></span>;

    <span class="hljs-comment">//根据分类名称查询分类</span>
    <span class="hljs-function">Type <span class="hljs-title">getTypeByName</span><span class="hljs-params">(String name)</span></span>;

    <span class="hljs-comment">//编辑修改分类</span>
    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">updateType</span><span class="hljs-params">(Type type)</span></span>;

    <span class="hljs-comment">//删除分类</span>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">deleteType</span><span class="hljs-params">(Long id)</span></span>;
&#125;</code></pre>

<h3 id="4-引入分页插件"><a href="#4-引入分页插件" class="headerlink" title="4. 引入分页插件"></a>4. 引入分页插件</h3><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--引入分页插件--&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.github.pagehelper<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>pagehelper-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2.12<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>



<h3 id="5-Controller"><a href="#5-Controller" class="headerlink" title="5.  Controller"></a>5.  Controller</h3><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.star.controller;
<span class="hljs-keyword">import</span> jdk.nashorn.internal.objects.annotations.Getter;
<span class="hljs-keyword">import</span> org.springframework.validation.annotation.Validated;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.*;
<span class="hljs-keyword">import</span> com.github.pagehelper.PageHelper;
<span class="hljs-keyword">import</span> com.github.pagehelper.PageInfo;
<span class="hljs-keyword">import</span> com.star.entity.Type;
<span class="hljs-keyword">import</span> com.star.service.TypeService;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Controller;
<span class="hljs-keyword">import</span> org.springframework.ui.Model;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestParam;
<span class="hljs-keyword">import</span> org.springframework.web.servlet.mvc.support.RedirectAttributes;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-meta">@Controller</span>
<span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">"/admin"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TypeController</span> </span>&#123;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> TypeService typeService;

    <span class="hljs-comment">//分页查询分类列表</span>
    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/types"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">list</span><span class="hljs-params">(Model model, @RequestParam(defaultValue = <span class="hljs-string">"1"</span>,value = <span class="hljs-string">"pageNum"</span>)</span>Integer pageNum)</span>&#123;
        String orderBy = <span class="hljs-string">"id desc"</span>;
        PageHelper.startPage(pageNum,<span class="hljs-number">10</span>,orderBy);
        List&lt;Type&gt; list = typeService.getAllType();
        PageInfo&lt;Type&gt; pageInfo = <span class="hljs-keyword">new</span> PageInfo&lt;Type&gt;(list);
        model.addAttribute(<span class="hljs-string">"pageInfo"</span>,pageInfo);
        <span class="hljs-keyword">return</span> <span class="hljs-string">"admin/types"</span>;
    &#125;

    <span class="hljs-comment">//返回新增分类页面</span>
    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"types/input"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">input</span><span class="hljs-params">(Model model)</span></span>&#123;
        model.addAttribute(<span class="hljs-string">"type"</span>,<span class="hljs-keyword">new</span> Type());
        <span class="hljs-keyword">return</span> <span class="hljs-string">"admin/types-input"</span>;
    &#125;

    <span class="hljs-comment">//新增分类</span>
    <span class="hljs-meta">@PostMapping</span>(<span class="hljs-string">"/types"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">post</span><span class="hljs-params">(Type type, RedirectAttributes attributes)</span></span>&#123;
        Type type1 = typeService.getTypeByName(type.getName());
        <span class="hljs-keyword">if</span>(type1 != <span class="hljs-keyword">null</span>)&#123;
            attributes.addFlashAttribute(<span class="hljs-string">"message"</span>,<span class="hljs-string">"不能添加重复的分类"</span>);
        &#125;
        <span class="hljs-keyword">int</span> t = typeService.saveType(type);
        <span class="hljs-keyword">if</span>(t == <span class="hljs-number">0</span>)&#123;
            attributes.addFlashAttribute(<span class="hljs-string">"message"</span>,<span class="hljs-string">"新增失败"</span>);
        &#125;<span class="hljs-keyword">else</span>&#123;
            attributes.addFlashAttribute(<span class="hljs-string">"message"</span>,<span class="hljs-string">"新增成功"</span>);
        &#125;
        <span class="hljs-keyword">return</span> <span class="hljs-string">"redirect:/admin/types"</span>;
    &#125;

    <span class="hljs-comment">//跳转修改分类界面</span>
    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/types/&#123;id&#125;/input"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">editInput</span><span class="hljs-params">(@PathVariable Long id,Model model)</span></span>&#123;
        model.addAttribute(<span class="hljs-string">"type"</span>,typeService.getType(id));
        <span class="hljs-keyword">return</span> <span class="hljs-string">"admin/types-input"</span>;
    &#125;

    <span class="hljs-comment">//编辑修改分类</span>
    <span class="hljs-meta">@PostMapping</span>(<span class="hljs-string">"/types/&#123;id&#125;"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">editPost</span><span class="hljs-params">(Type type,RedirectAttributes attributes)</span></span>&#123;
        Type type1 = typeService.getTypeByName(type.getName());
        <span class="hljs-keyword">if</span>(type1 != <span class="hljs-keyword">null</span>)&#123;
            attributes.addFlashAttribute(<span class="hljs-string">"message"</span>,<span class="hljs-string">"不能添加重复的分类"</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-string">"redirect:/admin/types/input"</span>;
        &#125;
        <span class="hljs-keyword">int</span> t = typeService.updateType(type);
        <span class="hljs-keyword">if</span>(t == <span class="hljs-number">0</span>)&#123;
            attributes.addFlashAttribute(<span class="hljs-string">"message"</span>,<span class="hljs-string">"编辑失败"</span>);
        &#125;<span class="hljs-keyword">else</span>&#123;
            attributes.addFlashAttribute(<span class="hljs-string">"message"</span>,<span class="hljs-string">"编辑成功"</span>);
        &#125;
        <span class="hljs-keyword">return</span> <span class="hljs-string">"redirect:/admin/types"</span>;
    &#125;

    <span class="hljs-comment">//删除分类</span>
    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/types/&#123;id&#125;/delete"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">delete</span><span class="hljs-params">(@PathVariable Long id,RedirectAttributes attributes)</span></span>&#123;
        typeService.deleteType(id);
        attributes.addFlashAttribute(<span class="hljs-string">"message"</span>,<span class="hljs-string">"删除成功"</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-string">"redirect:/admin/types"</span>;
    &#125;
&#125;</code></pre>



<h2 id="7-博客管理"><a href="#7-博客管理" class="headerlink" title="7. 博客管理"></a>7. 博客管理</h2><h3 id="1-创建查询实体类BlogQuery，ShowBlog，SearchBlog"><a href="#1-创建查询实体类BlogQuery，ShowBlog，SearchBlog" class="headerlink" title="1.  创建查询实体类BlogQuery，ShowBlog，SearchBlog"></a>1.  创建查询实体类BlogQuery，ShowBlog，SearchBlog</h3><ul>
<li>建立不同的查询类是为了分离，如BlogQuery就是为了显示列表，显示列表的所有元素就是当前BlogQuery的属性</li>
<li>同理，ShowBlog就是编辑修改页面，需要用到的属性</li>
<li>SearchBlog，由于搜索博客只需要两个属性，建立一个SearchBlog单独用来创立视图层引用</li>
<li>以上三个业务层和持久层都是用的BlogDao和BlogService层</li>
</ul>
<pre><code class="hljs java"><span class="hljs-keyword">package</span> com.star.entity;

<span class="hljs-keyword">import</span> lombok.AllArgsConstructor;
<span class="hljs-keyword">import</span> lombok.Getter;
<span class="hljs-keyword">import</span> lombok.NoArgsConstructor;
<span class="hljs-keyword">import</span> lombok.Setter;

<span class="hljs-keyword">import</span> java.util.Date;

<span class="hljs-comment">/**</span>
<span class="hljs-comment"> * 查询博客列表</span>
<span class="hljs-comment"> */</span>
<span class="hljs-meta">@AllArgsConstructor</span>
<span class="hljs-meta">@NoArgsConstructor</span>
<span class="hljs-meta">@Getter</span>
<span class="hljs-meta">@Setter</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BlogQuery</span> </span>&#123;
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String title;
    <span class="hljs-keyword">private</span> Date updateTime;
    <span class="hljs-keyword">private</span> Boolean recommend;
    <span class="hljs-keyword">private</span> Boolean published;
    <span class="hljs-keyword">private</span> Long typeId;
    <span class="hljs-keyword">private</span> Type type;
&#125;</code></pre>

<pre><code class="hljs java"><span class="hljs-keyword">package</span> com.star.entity;

<span class="hljs-keyword">import</span> lombok.AllArgsConstructor;
<span class="hljs-keyword">import</span> lombok.Getter;
<span class="hljs-keyword">import</span> lombok.NoArgsConstructor;
<span class="hljs-keyword">import</span> lombok.Setter;

<span class="hljs-keyword">import</span> java.util.Date;

<span class="hljs-comment">/**</span>
<span class="hljs-comment"> * 编辑修改文章实体类</span>
<span class="hljs-comment"> */</span>
<span class="hljs-meta">@AllArgsConstructor</span>
<span class="hljs-meta">@NoArgsConstructor</span>
<span class="hljs-meta">@Getter</span>
<span class="hljs-meta">@Setter</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ShowBlog</span> </span>&#123;
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String flag;
    <span class="hljs-keyword">private</span> String title;
    <span class="hljs-keyword">private</span> String content;
    <span class="hljs-keyword">private</span> Long typeId;
    <span class="hljs-keyword">private</span> String firstPicture;
    <span class="hljs-keyword">private</span> String description;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> recommend;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> published;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> shareStatement;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> appreciation;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> commentabled;
    <span class="hljs-keyword">private</span> Date updateTime;
&#125;</code></pre>

<pre><code class="hljs java"><span class="hljs-keyword">package</span> com.star.entity;

<span class="hljs-keyword">import</span> lombok.AllArgsConstructor;
<span class="hljs-keyword">import</span> lombok.Getter;
<span class="hljs-keyword">import</span> lombok.NoArgsConstructor;
<span class="hljs-keyword">import</span> lombok.Setter;

<span class="hljs-comment">/**</span>
<span class="hljs-comment"> * 搜索博客管理列表</span>
<span class="hljs-comment"> */</span>
<span class="hljs-meta">@AllArgsConstructor</span>
<span class="hljs-meta">@NoArgsConstructor</span>
<span class="hljs-meta">@Getter</span>
<span class="hljs-meta">@Setter</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SearchBlog</span> </span>&#123;
    <span class="hljs-keyword">private</span> String title;
    <span class="hljs-keyword">private</span> Long typeId;
&#125;</code></pre>

<h3 id="2-Dao层和Service及Impl"><a href="#2-Dao层和Service及Impl" class="headerlink" title="2. Dao层和Service及Impl"></a>2. Dao层和Service及Impl</h3><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.star.dao;

<span class="hljs-keyword">import</span> com.star.entity.Blog;
<span class="hljs-keyword">import</span> com.star.entity.BlogQuery;
<span class="hljs-keyword">import</span> com.star.entity.SearchBlog;
<span class="hljs-keyword">import</span> com.star.entity.ShowBlog;
<span class="hljs-keyword">import</span> org.apache.ibatis.annotations.Mapper;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Repository;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-meta">@Mapper</span>
<span class="hljs-meta">@Repository</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">BlogDao</span> </span>&#123;
    <span class="hljs-comment">//保存新增博客</span>
    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">saveBlog</span><span class="hljs-params">(Blog blog)</span></span>;

    <span class="hljs-comment">//查询文章管理列表</span>
    <span class="hljs-function">List&lt;BlogQuery&gt; <span class="hljs-title">getAllBlogQuery</span><span class="hljs-params">()</span></span>;

    <span class="hljs-comment">//删除博客</span>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">deleteBlog</span><span class="hljs-params">(Long id)</span></span>;

    <span class="hljs-comment">//更新博客</span>
    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">updateBlog</span><span class="hljs-params">(ShowBlog showBlog)</span></span>;

    <span class="hljs-comment">//查询编辑修改的文章</span>
    <span class="hljs-function">ShowBlog <span class="hljs-title">getBlogById</span><span class="hljs-params">(Long id)</span></span>;

    <span class="hljs-comment">//搜索博客管理列表</span>
    <span class="hljs-function">List&lt;BlogQuery&gt; <span class="hljs-title">searchByTitleAndType</span><span class="hljs-params">(SearchBlog searchBlog)</span></span>;
&#125;</code></pre>

<pre><code class="hljs java"><span class="hljs-keyword">package</span> com.star.service;

<span class="hljs-keyword">import</span> com.star.entity.Blog;
<span class="hljs-keyword">import</span> com.star.entity.BlogQuery;
<span class="hljs-keyword">import</span> com.star.entity.SearchBlog;
<span class="hljs-keyword">import</span> com.star.entity.ShowBlog;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">BlogService</span> </span>&#123;
    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">saveBlog</span><span class="hljs-params">(Blog blog)</span></span>;
    <span class="hljs-function">List&lt;BlogQuery&gt; <span class="hljs-title">getAllBlog</span><span class="hljs-params">()</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">deleteBlog</span><span class="hljs-params">(Long id)</span></span>;
    <span class="hljs-function">ShowBlog <span class="hljs-title">getBlogById</span><span class="hljs-params">(Long id)</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">updateBlog</span><span class="hljs-params">(ShowBlog showBlog)</span></span>;
    <span class="hljs-function">List&lt;BlogQuery&gt; <span class="hljs-title">getBlogBySearch</span><span class="hljs-params">(SearchBlog searchBlog)</span></span>;
&#125;</code></pre>

<pre><code class="hljs java"><span class="hljs-keyword">package</span> com.star.service.impl;

<span class="hljs-keyword">import</span> com.star.dao.BlogDao;
<span class="hljs-keyword">import</span> com.star.entity.Blog;
<span class="hljs-keyword">import</span> com.star.entity.BlogQuery;
<span class="hljs-keyword">import</span> com.star.entity.SearchBlog;
<span class="hljs-keyword">import</span> com.star.entity.ShowBlog;
<span class="hljs-keyword">import</span> com.star.service.BlogService;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;

<span class="hljs-keyword">import</span> java.util.Date;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BlogServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">BlogService</span> </span>&#123;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> BlogDao blogDao;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">saveBlog</span><span class="hljs-params">(Blog blog)</span> </span>&#123;
        blog.setCreateTime(<span class="hljs-keyword">new</span> Date());
        blog.setUpdateTime(<span class="hljs-keyword">new</span> Date());
        blog.setViews(<span class="hljs-number">0</span>);
        blog.setCommentCount(<span class="hljs-number">0</span>);
        <span class="hljs-keyword">return</span> blogDao.saveBlog(blog);
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;BlogQuery&gt; <span class="hljs-title">getAllBlog</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> blogDao.getAllBlogQuery();
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">deleteBlog</span><span class="hljs-params">(Long id)</span> </span>&#123;
        blogDao.deleteBlog(id);
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> ShowBlog <span class="hljs-title">getBlogById</span><span class="hljs-params">(Long id)</span> </span>&#123;
        <span class="hljs-keyword">return</span> blogDao.getBlogById(id);
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">updateBlog</span><span class="hljs-params">(ShowBlog showBlog)</span> </span>&#123;
        showBlog.setUpdateTime(<span class="hljs-keyword">new</span> Date());
        <span class="hljs-keyword">return</span> blogDao.updateBlog(showBlog);
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;BlogQuery&gt; <span class="hljs-title">getBlogBySearch</span><span class="hljs-params">(SearchBlog searchBlog)</span> </span>&#123;
        <span class="hljs-keyword">return</span> blogDao.searchByTitleAndType(searchBlog);
    &#125;
&#125;</code></pre>

<h3 id="3-mapper文件，这里设计多表查询，较为复杂"><a href="#3-mapper文件，这里设计多表查询，较为复杂" class="headerlink" title="3. mapper文件，这里设计多表查询，较为复杂"></a>3. mapper文件，这里设计多表查询，较为复杂</h3><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8" ?&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">mapper</span> <span class="hljs-meta-keyword">PUBLIC</span> <span class="hljs-meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span> <span class="hljs-meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span> &gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">"com.star.dao.BlogDao"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"saveBlog"</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">"com.star.entity.Blog"</span>&gt;</span>
        insert into myblog.t_blog (id,title, content, first_picture, flag,
    views, comment_count, appreciation, share_statement, commentabled, published,
    recommend, create_time, update_time, type_id, user_id, description)
    values (#&#123;id&#125;,#&#123;title&#125;,#&#123;content&#125;,#&#123;firstPicture&#125;,#&#123;flag&#125;,#&#123;views&#125;,#&#123;commentCount&#125;,#&#123;appreciation&#125;,
    #&#123;shareStatement&#125;,#&#123;commentabled&#125;,#&#123;published&#125;,#&#123;recommend&#125;,#&#123;createTime&#125;,
    #&#123;updateTime&#125;,#&#123;typeId&#125;,#&#123;userId&#125;,#&#123;description&#125;);
    <span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 查询文章管理列表多对一配置 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"blog"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"com.star.entity.BlogQuery"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"id"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"id"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"title"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"title"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"updateTime"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"update_Time"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"recommend"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"recommend"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"published"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"published"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"typeId"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"type_id"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">association</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"type"</span> <span class="hljs-attr">javaType</span>=<span class="hljs-string">"com.star.entity.Type"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"id"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"id"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"name"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"name"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">association</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 查询文章管理列表 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"getAllBlogQuery"</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">"blog"</span>&gt;</span>
        select b.id,b.title,b.update_time,b.recommend,b.published,b.type_id,t.id,t.name
    from myblog.t_blog b left outer join
    myblog.t_type t on b.type_id = t.id order by b.update_time desc
    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 删除博客 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">delete</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"deleteBlog"</span>&gt;</span>
        delete from myblog.t_blog where id = #&#123;id&#125;;
    <span class="hljs-tag">&lt;/<span class="hljs-name">delete</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 更新博客 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">update</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"updateBlog"</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">"com.star.entity.ShowBlog"</span>&gt;</span>
    update myblog.t_blog set published = #&#123;published&#125;,flag = #&#123;flag&#125; ,
    title = #&#123;title&#125;, content = #&#123;content&#125;, type_id = #&#123;typeId&#125;,
    first_picture = #&#123;firstPicture&#125; , description = #&#123;description&#125; , recommend = #&#123;recommend&#125; ,
    share_statement = #&#123;shareStatement&#125;, appreciation = #&#123;appreciation&#125;,
    commentabled = #&#123;commentabled&#125; ,update_time = #&#123;updateTime&#125; where id = #&#123;id&#125;;
    <span class="hljs-tag">&lt;/<span class="hljs-name">update</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 查询编辑修改的文章 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"getBlogById"</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">"com.star.entity.ShowBlog"</span>&gt;</span>
    select b.id,b.flag,b.title,b.content,b.type_id,
    b.first_picture,b.description,b.recommend,b.published,b.share_statement,
    b.appreciation,b.commentabled from myblog.t_blog b  where  b.id = #&#123;id&#125;;
    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>
	<span class="hljs-comment">&lt;!-- 模糊查询 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"searchByTitleAndType"</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">"com.star.entity.SearchBlog"</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">"blog"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">bind</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"pattern"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"'%' + title + '%'"</span> /&gt;</span>
        select b.id,b.title,b.type_id,t.id,t.name from myblog.t_blog b ,myblog.t_type t
        <span class="hljs-tag">&lt;<span class="hljs-name">where</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">"1 == 1"</span>&gt;</span>
                b.type_id = t.id
            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">"typeId != null"</span>&gt;</span>
                and b.type_id = #&#123;typeId&#125;
            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">"title != null"</span>&gt;</span>
                and b.title like #&#123;pattern&#125;
            <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">where</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span></code></pre>

<h3 id="4-resultMap-xml详解"><a href="#4-resultMap-xml详解" class="headerlink" title="4. resultMap/xml详解"></a>4. resultMap/xml详解</h3><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--column不做限制，可以为任意表的字段，而property须为type 定义的pojo属性--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"唯一的标识"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"映射的pojo对象"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"表的主键字段，或者可以为查询语句中的别名字段"</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">"字段类型"</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"映射pojo对象的主键属性"</span> /&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"表的一个字段（可以为任意表的一个字段）"</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">"字段类型"</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"映射到pojo对象的一个属性（须为type定义的pojo对象中的一个属性）"</span>/&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">association</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"pojo的一个对象属性"</span> <span class="hljs-attr">javaType</span>=<span class="hljs-string">"pojo关联的pojo对象"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"关联pojo对象对应表的主键字段"</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">"字段类型"</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"关联pojo对象的主席属性"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span>  <span class="hljs-attr">column</span>=<span class="hljs-string">"任意表的字段"</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">"字段类型"</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"关联pojo对象的属性"</span>/&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">association</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- 集合中的property须为oftype定义的pojo对象的属性--&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">collection</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"pojo的集合属性"</span> <span class="hljs-attr">ofType</span>=<span class="hljs-string">"集合中的pojo对象"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"集合中pojo对象对应的表的主键字段"</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">"字段类型"</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"集合中pojo对象的主键属性"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"可以为任意表的字段"</span> <span class="hljs-attr">jdbcType</span>=<span class="hljs-string">"字段类型"</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"集合中的pojo对象的属性"</span> /&gt;</span>  
  <span class="hljs-tag">&lt;/<span class="hljs-name">collection</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span></code></pre>



<h3 id="5-Controller-1"><a href="#5-Controller-1" class="headerlink" title="5.  Controller"></a>5.  Controller</h3><ul>
<li>注意controller下的方法互相跳转，需要在return中加 “<code>redirect:</code>“</li>
</ul>
<pre><code class="hljs java"><span class="hljs-keyword">package</span> com.star.controller;

<span class="hljs-keyword">import</span> com.github.pagehelper.PageHelper;
<span class="hljs-keyword">import</span> com.github.pagehelper.PageInfo;
<span class="hljs-keyword">import</span> com.star.entity.*;
<span class="hljs-keyword">import</span> com.star.service.BlogService;
<span class="hljs-keyword">import</span> com.star.service.TypeService;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Controller;
<span class="hljs-keyword">import</span> org.springframework.ui.Model;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.*;
<span class="hljs-keyword">import</span> org.springframework.web.servlet.mvc.support.RedirectAttributes;

<span class="hljs-keyword">import</span> javax.servlet.http.HttpSession;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-meta">@Controller</span>
<span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">"/admin"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BlogController</span> </span>&#123;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> BlogService blogService;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> TypeService typeService;

    <span class="hljs-comment">//跳转博客新增页面</span>
    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/blogs/input"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">input</span><span class="hljs-params">(Model model)</span></span>&#123;
        model.addAttribute(<span class="hljs-string">"types"</span>,typeService.getAllType());
        model.addAttribute(<span class="hljs-string">"blog"</span>,<span class="hljs-keyword">new</span> Blog());
        <span class="hljs-keyword">return</span> <span class="hljs-string">"admin/blogs-input"</span>;
    &#125;

    <span class="hljs-comment">//博客新增</span>
    <span class="hljs-meta">@PostMapping</span>(<span class="hljs-string">"/blogs"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">post</span><span class="hljs-params">(Blog blog, RedirectAttributes attributes, HttpSession session)</span></span>&#123;
        blog.setUser((User)session.getAttribute(<span class="hljs-string">"user"</span>));
        blog.setType(typeService.getType(blog.getType().getId()));
        blog.setTypeId(blog.getType().getId());
        blog.setUserId(blog.getUser().getId());

        <span class="hljs-keyword">int</span> b = blogService.saveBlog(blog);
        <span class="hljs-keyword">if</span>(b == <span class="hljs-number">0</span>)&#123;
            attributes.addFlashAttribute(<span class="hljs-string">"message"</span>,<span class="hljs-string">"新增失败"</span>);
        &#125;<span class="hljs-keyword">else</span>&#123;
            attributes.addFlashAttribute(<span class="hljs-string">"message"</span>,<span class="hljs-string">"新增新增"</span>);
        &#125;
        <span class="hljs-keyword">return</span> <span class="hljs-string">"redirect:/admin/blogs"</span>;
    &#125;

    <span class="hljs-comment">//博客列表</span>
    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/blogs"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">blogs</span><span class="hljs-params">(Model model, @RequestParam(defaultValue = <span class="hljs-string">"1"</span>,value = <span class="hljs-string">"pageNum"</span>)</span> Integer pageNum)</span>&#123;

        String orderBy = <span class="hljs-string">"update_time desc"</span>;
        PageHelper.startPage(pageNum,<span class="hljs-number">10</span>,orderBy);
        List&lt;BlogQuery&gt; list = blogService.getAllBlog();
        PageInfo&lt;BlogQuery&gt; pageInfo = <span class="hljs-keyword">new</span> PageInfo&lt;BlogQuery&gt;(list);
        model.addAttribute(<span class="hljs-string">"types"</span>,typeService.getAllType());
        model.addAttribute(<span class="hljs-string">"pageInfo"</span>,pageInfo);
        <span class="hljs-keyword">return</span> <span class="hljs-string">"admin/blogs"</span>;
    &#125;

    <span class="hljs-comment">//删除博客</span>
    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/blogs/&#123;id&#125;/delete"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">delete</span><span class="hljs-params">(@PathVariable Long id,RedirectAttributes attributes)</span></span>&#123;
        blogService.deleteBlog(id);
        attributes.addFlashAttribute(<span class="hljs-string">"message"</span>,<span class="hljs-string">"删除成功"</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-string">"redirect:/admin/blogs"</span>;
    &#125;

    <span class="hljs-comment">//跳转到编辑修改文章</span>
    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/blogs/&#123;id&#125;/input"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">editInput</span><span class="hljs-params">(@PathVariable Long id,Model model)</span></span>&#123;
        ShowBlog blogById = blogService.getBlogById(id);
        List&lt;Type&gt; allType = typeService.getAllType();
        model.addAttribute(<span class="hljs-string">"blog"</span>,blogById);
        model.addAttribute(<span class="hljs-string">"types"</span>,allType);
        <span class="hljs-keyword">return</span> <span class="hljs-string">"admin/blogs-input"</span>;
    &#125;

    <span class="hljs-comment">//编辑修改文章</span>
    <span class="hljs-meta">@PostMapping</span>(<span class="hljs-string">"blogs/&#123;id&#125;"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">editPost</span><span class="hljs-params">(ShowBlog showBlog,RedirectAttributes attributes)</span></span>&#123;
        <span class="hljs-keyword">int</span> b = blogService.updateBlog(showBlog);
        <span class="hljs-keyword">if</span>(b == <span class="hljs-number">0</span>)&#123;
            attributes.addFlashAttribute(<span class="hljs-string">"message"</span>,<span class="hljs-string">"编辑成功"</span>);
        &#125;<span class="hljs-keyword">else</span>&#123;
            attributes.addFlashAttribute(<span class="hljs-string">"message"</span>,<span class="hljs-string">"编辑失败"</span>);
        &#125;
        <span class="hljs-keyword">return</span> <span class="hljs-string">"redirect:/admin/blogs"</span>;
    &#125;

    <span class="hljs-comment">//搜索博客管理列表</span>
    <span class="hljs-meta">@PostMapping</span>(<span class="hljs-string">"/blogs/search"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">search</span><span class="hljs-params">(SearchBlog searchBlog,Model model,</span></span>
<span class="hljs-function"><span class="hljs-params">                         @RequestParam(defaultValue = <span class="hljs-string">"1"</span>,value = <span class="hljs-string">"pageNum"</span>)</span>Integer pageNum)</span>&#123;
        List&lt;BlogQuery&gt; blogBySearch = blogService.getBlogBySearch(searchBlog);
        PageHelper.startPage(pageNum,<span class="hljs-number">10</span>);
        PageInfo&lt;BlogQuery&gt; pageInfo = <span class="hljs-keyword">new</span> PageInfo&lt;&gt;(blogBySearch);
        model.addAttribute(<span class="hljs-string">"pageInfo"</span>,pageInfo);
        <span class="hljs-comment">//这是thymeleaf的一个模板片断，相当于返回admin/blogs模板中的某个片段。</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">"admin/blogs :: blogList"</span>;
    &#125;
&#125;</code></pre>



<h2 id="8-友链管理"><a href="#8-友链管理" class="headerlink" title="8. 友链管理"></a>8. 友链管理</h2><p><strong>友链功能：CRUD，还需要编辑修改友链传递数据，新增作重复判断</strong></p>
<h3 id="Dao文件接口"><a href="#Dao文件接口" class="headerlink" title="Dao文件接口"></a>Dao文件接口</h3><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.star.dao;

<span class="hljs-keyword">import</span> com.star.entity.FriendLink;
<span class="hljs-keyword">import</span> org.apache.ibatis.annotations.Mapper;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Repository;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-meta">@Mapper</span>
<span class="hljs-meta">@Repository</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">FriendLinkDao</span> </span>&#123;
    <span class="hljs-comment">//查询友链管理列表</span>
    <span class="hljs-function">List&lt;FriendLink&gt; <span class="hljs-title">listFriendLink</span><span class="hljs-params">()</span></span>;

    <span class="hljs-comment">//新增友链</span>
    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">saveFriendLink</span><span class="hljs-params">(FriendLink friendLink)</span></span>;

    <span class="hljs-comment">//根据网址查询友链</span>
    <span class="hljs-function">FriendLink <span class="hljs-title">getFriendLinkByBlogaddress</span><span class="hljs-params">(String blogaddress)</span></span>;

    <span class="hljs-comment">//根据id查询友链</span>
    <span class="hljs-function">FriendLink <span class="hljs-title">getFriendLink</span><span class="hljs-params">(Long id)</span></span>;

    <span class="hljs-comment">//编辑修改友链</span>
    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">updateFriendLink</span><span class="hljs-params">(FriendLink friendLink)</span></span>;

    <span class="hljs-comment">//删除友链</span>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">deleteFriendLink</span><span class="hljs-params">(Long id)</span></span>;
&#125;</code></pre>

<h3 id="xml文件"><a href="#xml文件" class="headerlink" title="xml文件"></a>xml文件</h3><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8" ?&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">mapper</span> <span class="hljs-meta-keyword">PUBLIC</span> <span class="hljs-meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span> <span class="hljs-meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span> &gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">"com.star.dao.FriendLinkDao"</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 查询所有友链 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"listFriendLink"</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">"com.star.entity.FriendLink"</span>&gt;</span>
        select * from myblog.t_friend order by t_friend.create_time desc
    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 添加友链 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"saveFriendLink"</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">"com.star.entity.FriendLink"</span>&gt;</span>
        insert into myblog.t_friend(blogaddress, blogname, create_time, pictureaddress)
        values (#&#123;blogaddress&#125;,#&#123;blogname&#125;,#&#123;createTime&#125;,#&#123;pictureaddress&#125;)
    <span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 根据网址查询友链 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"getFriendLinkByBlogaddress"</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">"com.star.entity.FriendLink"</span>&gt;</span>
        select * from myblog.t_friend f where f.blogaddress = #&#123;blogaddress&#125;;
    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 根据id查询友链 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"getFriendLink"</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">"com.star.entity.FriendLink"</span>&gt;</span>
        select * from myblog.t_friend f where f.id = #&#123;id&#125;;
    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 编辑修改友链 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">update</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"updateFriendLink"</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">"com.star.entity.FriendLink"</span>&gt;</span>
        update myblog.t_friend set blogname = #&#123;blogname&#125;,blogaddress = #&#123;blogaddress&#125;, pictureaddress = #&#123;pictureaddress&#125;
        where id = #&#123;id&#125;;
    <span class="hljs-tag">&lt;/<span class="hljs-name">update</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 删除友链 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">delete</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"deleteFriendLink"</span>&gt;</span>
        delete from myblog.t_friend where id= #&#123;id&#125;;
    <span class="hljs-tag">&lt;/<span class="hljs-name">delete</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span></code></pre>

<h3 id="Service及Impl"><a href="#Service及Impl" class="headerlink" title="Service及Impl"></a>Service及Impl</h3><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.star.service;

<span class="hljs-keyword">import</span> com.star.entity.FriendLink;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">FriendLinkService</span> </span>&#123;
    <span class="hljs-comment">//查询友链管理列表</span>
    <span class="hljs-function">List&lt;FriendLink&gt; <span class="hljs-title">listFriendLink</span><span class="hljs-params">()</span></span>;

    <span class="hljs-comment">//新增友链</span>
    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">saveFriendLink</span><span class="hljs-params">(FriendLink friendLink)</span></span>;

    <span class="hljs-comment">//根据网址查询友链</span>
    <span class="hljs-function">FriendLink <span class="hljs-title">getFriendLinkByBlogaddress</span><span class="hljs-params">(String blogaddress)</span></span>;

    <span class="hljs-comment">//根据id查询友链</span>
    <span class="hljs-function">FriendLink <span class="hljs-title">getFriendLink</span><span class="hljs-params">(Long id)</span></span>;

    <span class="hljs-comment">//编辑修改友链</span>
    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">updateFriendLink</span><span class="hljs-params">(FriendLink friendLink)</span></span>;

    <span class="hljs-comment">//删除友链</span>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">deleteFriendLink</span><span class="hljs-params">(Long id)</span></span>;
&#125;</code></pre>

<pre><code class="hljs java"><span class="hljs-keyword">package</span> com.star.service.impl;

<span class="hljs-keyword">import</span> com.star.dao.FriendLinkDao;
<span class="hljs-keyword">import</span> com.star.entity.FriendLink;
<span class="hljs-keyword">import</span> com.star.service.FriendLinkService;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;

<span class="hljs-keyword">import</span> java.util.List;
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FriendLinkServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">FriendLinkService</span> </span>&#123;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> FriendLinkDao friendLinkDao;
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;FriendLink&gt; <span class="hljs-title">listFriendLink</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> friendLinkDao.listFriendLink();
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">saveFriendLink</span><span class="hljs-params">(FriendLink friendLink)</span> </span>&#123;
        <span class="hljs-keyword">return</span> friendLinkDao.saveFriendLink(friendLink);
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> FriendLink <span class="hljs-title">getFriendLinkByBlogaddress</span><span class="hljs-params">(String blogaddress)</span> </span>&#123;
        <span class="hljs-keyword">return</span>  friendLinkDao.getFriendLinkByBlogaddress(blogaddress);
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> FriendLink <span class="hljs-title">getFriendLink</span><span class="hljs-params">(Long id)</span> </span>&#123;
        <span class="hljs-keyword">return</span> friendLinkDao.getFriendLink(id);
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">updateFriendLink</span><span class="hljs-params">(FriendLink friendLink)</span> </span>&#123;
        <span class="hljs-keyword">return</span> friendLinkDao.updateFriendLink(friendLink);
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">deleteFriendLink</span><span class="hljs-params">(Long id)</span> </span>&#123;
        friendLinkDao.deleteFriendLink(id);
    &#125;
&#125;</code></pre>

<h3 id="Controller层"><a href="#Controller层" class="headerlink" title="Controller层"></a>Controller层</h3><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.star.controller;

<span class="hljs-keyword">import</span> com.github.pagehelper.PageHelper;
<span class="hljs-keyword">import</span> com.github.pagehelper.PageInfo;
<span class="hljs-keyword">import</span> com.star.entity.FriendLink;
<span class="hljs-keyword">import</span> com.star.service.FriendLinkService;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Controller;
<span class="hljs-keyword">import</span> org.springframework.ui.Model;
<span class="hljs-keyword">import</span> org.springframework.validation.BindingResult;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.*;
<span class="hljs-keyword">import</span> org.springframework.web.servlet.mvc.support.RedirectAttributes;

<span class="hljs-keyword">import</span> java.util.Date;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-meta">@Controller</span>
<span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">"/admin"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FriendController</span> </span>&#123;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> FriendLinkService friendLinkService;

    <span class="hljs-comment">//查询所有友链</span>
    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/friendlinks"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">friend</span><span class="hljs-params">(Model model, @RequestParam(defaultValue = <span class="hljs-string">"1"</span>,value = <span class="hljs-string">"pageNum"</span>)</span> Integer pageNum)</span>&#123;
        PageHelper.startPage(pageNum,<span class="hljs-number">10</span>);
        List&lt;FriendLink&gt; friendLinkList = friendLinkService.listFriendLink();
        PageInfo&lt;FriendLink&gt; pageInfo = <span class="hljs-keyword">new</span> PageInfo&lt;&gt;(friendLinkList);
        model.addAttribute(<span class="hljs-string">"pageInfo"</span>,pageInfo);
        <span class="hljs-keyword">return</span> <span class="hljs-string">"admin/friendlinks"</span>;
    &#125;


    <span class="hljs-comment">//跳转友链新增界面</span>
    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/friendlinks/input"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">input</span><span class="hljs-params">(Model model)</span></span>&#123;
        model.addAttribute(<span class="hljs-string">"friendlink"</span>,<span class="hljs-keyword">new</span> FriendLink());
        <span class="hljs-keyword">return</span> <span class="hljs-string">"admin/friendlinks-input"</span>;
    &#125;


    <span class="hljs-comment">//新增友链</span>
    <span class="hljs-meta">@PostMapping</span>(<span class="hljs-string">"/friendlinks"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">post</span><span class="hljs-params">(FriendLink friendLink, BindingResult result, RedirectAttributes attributes)</span></span>&#123;
        FriendLink type1 = friendLinkService.getFriendLinkByBlogaddress(friendLink.getBlogaddress());
        <span class="hljs-keyword">if</span>(type1 != <span class="hljs-keyword">null</span>)&#123;
            attributes.addFlashAttribute(<span class="hljs-string">"message"</span>,<span class="hljs-string">"不能添加相同网址"</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-string">"redirect:/admin/friendlinks/input"</span>;
        &#125;
        <span class="hljs-keyword">if</span>(result.hasErrors())&#123;
            <span class="hljs-keyword">return</span> <span class="hljs-string">"admin/friendlinks-input"</span>;
        &#125;
        friendLink.setCreateTime(<span class="hljs-keyword">new</span> Date());

        <span class="hljs-keyword">int</span> f = friendLinkService.saveFriendLink(friendLink);
        <span class="hljs-keyword">if</span>(f == <span class="hljs-number">0</span>)&#123;
            attributes.addFlashAttribute(<span class="hljs-string">"message"</span>,<span class="hljs-string">"新增失败"</span>);
        &#125;<span class="hljs-keyword">else</span>&#123;
            attributes.addFlashAttribute(<span class="hljs-string">"message"</span>,<span class="hljs-string">"新增成功"</span>);
        &#125;
        <span class="hljs-keyword">return</span> <span class="hljs-string">"redirect:/admin/friendlinks"</span>;
    &#125;


    <span class="hljs-comment">//跳转友链修改界面</span>
    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"friendlinks/&#123;id&#125;/input"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">editInput</span><span class="hljs-params">(@PathVariable Long id,Model model)</span></span>&#123;
        <span class="hljs-comment">//修改时，自动给界面赋值需要修改的友链字段，方便用户修改</span>
        model.addAttribute(<span class="hljs-string">"friendlink"</span>,friendLinkService.getFriendLink(id));
        <span class="hljs-keyword">return</span> <span class="hljs-string">"admin/friendlinks-input"</span>;
    &#125;
    <span class="hljs-comment">//友链修改</span>
    <span class="hljs-meta">@PostMapping</span>(<span class="hljs-string">"/friendlinks/&#123;id&#125;"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">editPost</span><span class="hljs-params">(FriendLink friendLink,RedirectAttributes attributes)</span></span>&#123;
        <span class="hljs-keyword">int</span> t = friendLinkService.updateFriendLink(friendLink);
        <span class="hljs-keyword">if</span>(t == <span class="hljs-number">0</span>)&#123;
            attributes.addFlashAttribute(<span class="hljs-string">"message"</span>,<span class="hljs-string">"编辑成功"</span>);
        &#125;<span class="hljs-keyword">else</span>&#123;
            attributes.addFlashAttribute(<span class="hljs-string">"message"</span>,<span class="hljs-string">"编辑失败"</span>);
        &#125;
        <span class="hljs-keyword">return</span> <span class="hljs-string">"redirect:/admin/friendlinks"</span>;
    &#125;
    <span class="hljs-comment">//友链删除</span>
    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/friendlinks/&#123;id&#125;/delete"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">delete</span><span class="hljs-params">(@PathVariable Long id,RedirectAttributes attributes)</span></span>&#123;
        friendLinkService.deleteFriendLink(id);
        attributes.addFlashAttribute(<span class="hljs-string">"message"</span>,<span class="hljs-string">"删除成功"</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-string">"redirect:/admin/friendlinks"</span>;
    &#125;

&#125;</code></pre>

<h2 id="9-相册管理"><a href="#9-相册管理" class="headerlink" title="9. 相册管理"></a>9. 相册管理</h2><p><strong>CRUD功能</strong></p>
<h3 id="Dao接口"><a href="#Dao接口" class="headerlink" title="Dao接口"></a>Dao接口</h3><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.star.dao;

<span class="hljs-keyword">import</span> com.star.entity.Picture;
<span class="hljs-keyword">import</span> org.apache.ibatis.annotations.Mapper;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Repository;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-meta">@Mapper</span>
<span class="hljs-meta">@Repository</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">PictureDao</span> </span>&#123;

    <span class="hljs-comment">//查询照片</span>
    <span class="hljs-function">List&lt;Picture&gt; <span class="hljs-title">listPicture</span><span class="hljs-params">()</span></span>;
    <span class="hljs-comment">//添加图片</span>
    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">savePicture</span><span class="hljs-params">(Picture picture)</span></span>;
    <span class="hljs-comment">//根据id查询图片</span>
    <span class="hljs-function">Picture <span class="hljs-title">getPicture</span><span class="hljs-params">(Long id)</span></span>;
    <span class="hljs-comment">//编辑修改相册</span>
    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">updatePicture</span><span class="hljs-params">(Picture picture)</span></span>;
    <span class="hljs-comment">//删除照片</span>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">deletePicture</span><span class="hljs-params">(Long id)</span></span>;
&#125;</code></pre>

<h3 id="xml文件-1"><a href="#xml文件-1" class="headerlink" title="xml文件"></a>xml文件</h3><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8" ?&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">mapper</span> <span class="hljs-meta-keyword">PUBLIC</span> <span class="hljs-meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span> <span class="hljs-meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span> &gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">"com.star.dao.PictureDao"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 查询所有照片 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"listPicture"</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">"com.star.entity.Picture"</span>&gt;</span>
        select * from myblog.t_picture order by t_picture.id desc
    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 添加照片 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"savePicture"</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">"com.star.entity.Picture"</span>&gt;</span>
        insert into myblog.t_picture (picturename,picturetime,pictureaddress,picturedescription)
        values (#&#123;picturename&#125;,#&#123;picturetime&#125;,#&#123;pictureaddress&#125;,#&#123;picturedescription&#125;)
    <span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 根据id查询照片 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"getPicture"</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">"com.star.entity.Picture"</span>&gt;</span>
        select * from myblog.t_picture p where p.id = #&#123;id&#125;;
    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 编辑修改相册 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">update</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"updatePicture"</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">"com.star.entity.Picture"</span>&gt;</span>
        update myblog.t_picture
        set picturename = #&#123;picturename&#125;, picturetime = #&#123;picturetime&#125;, pictureaddress = #&#123;pictureaddress&#125;, picturedescription = #&#123;picturedescription&#125;
        where id = #&#123;id&#125;;
    <span class="hljs-tag">&lt;/<span class="hljs-name">update</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 删除照片 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">delete</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"deletePicture"</span>&gt;</span>
        delete from myblog.t_picture where id = #&#123;id&#125;;
    <span class="hljs-tag">&lt;/<span class="hljs-name">delete</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span></code></pre>

<h3 id="Service及Impl-1"><a href="#Service及Impl-1" class="headerlink" title="Service及Impl"></a>Service及Impl</h3><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.star.service;

<span class="hljs-keyword">import</span> com.star.entity.Picture;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">PictureService</span> </span>&#123;

    <span class="hljs-comment">//查询照片</span>
    <span class="hljs-function">List&lt;Picture&gt; <span class="hljs-title">listPicture</span><span class="hljs-params">()</span></span>;
    <span class="hljs-comment">//添加图片</span>
    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">savePicture</span><span class="hljs-params">(Picture picture)</span></span>;
    <span class="hljs-comment">//根据id查询图片</span>
    <span class="hljs-function">Picture <span class="hljs-title">getPicture</span><span class="hljs-params">(Long id)</span></span>;
    <span class="hljs-comment">//编辑修改相册</span>
    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">updatePicture</span><span class="hljs-params">(Picture picture)</span></span>;
    <span class="hljs-comment">//删除照片</span>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">deletePicture</span><span class="hljs-params">(Long id)</span></span>;
&#125;</code></pre>

<pre><code class="hljs java"><span class="hljs-keyword">package</span> com.star.service.impl;

<span class="hljs-keyword">import</span> com.star.dao.PictureDao;
<span class="hljs-keyword">import</span> com.star.entity.Picture;
<span class="hljs-keyword">import</span> com.star.service.PictureService;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;

<span class="hljs-keyword">import</span> java.util.List;
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PictureServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">PictureService</span> </span>&#123;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> PictureDao pictureDao;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Picture&gt; <span class="hljs-title">listPicture</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> pictureDao.listPicture();
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">savePicture</span><span class="hljs-params">(Picture picture)</span> </span>&#123;
        <span class="hljs-keyword">return</span> pictureDao.savePicture(picture);
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Picture <span class="hljs-title">getPicture</span><span class="hljs-params">(Long id)</span> </span>&#123;
        <span class="hljs-keyword">return</span> pictureDao.getPicture(id);
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">updatePicture</span><span class="hljs-params">(Picture picture)</span> </span>&#123;
        <span class="hljs-keyword">return</span> pictureDao.updatePicture(picture);
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">deletePicture</span><span class="hljs-params">(Long id)</span> </span>&#123;
        pictureDao.deletePicture(id);
    &#125;
&#125;</code></pre>

<h3 id="Controller"><a href="#Controller" class="headerlink" title="Controller"></a>Controller</h3><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.star.controller;

<span class="hljs-keyword">import</span> com.github.pagehelper.PageHelper;
<span class="hljs-keyword">import</span> com.github.pagehelper.PageInfo;
<span class="hljs-keyword">import</span> com.star.entity.Picture;
<span class="hljs-keyword">import</span> com.star.service.PictureService;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Controller;
<span class="hljs-keyword">import</span> org.springframework.ui.Model;
<span class="hljs-keyword">import</span> org.springframework.validation.BindingResult;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.*;
<span class="hljs-keyword">import</span> org.springframework.web.servlet.mvc.support.RedirectAttributes;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-meta">@Controller</span>
<span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">"/admin"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PictureController</span> </span>&#123;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> PictureService pictureService;

    <span class="hljs-comment">//查询照片列表</span>
    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/pictures"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">pictures</span><span class="hljs-params">(Model model, @RequestParam(defaultValue = <span class="hljs-string">"1"</span>,value = <span class="hljs-string">"pageNum"</span>)</span>Integer pageNum)</span>&#123;
        PageHelper.startPage(pageNum,<span class="hljs-number">10</span>);
        List&lt;Picture&gt; pictureList = pictureService.listPicture();
        PageInfo&lt;Picture&gt; pageInfo = <span class="hljs-keyword">new</span> PageInfo&lt;&gt;(pictureList);
        model.addAttribute(<span class="hljs-string">"pageInfo"</span>,pageInfo);
        <span class="hljs-keyword">return</span> <span class="hljs-string">"admin/pictures"</span>;
    &#125;
    <span class="hljs-comment">//跳转到新增页面</span>
    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/pictures/input"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">input</span><span class="hljs-params">(Model model)</span></span>&#123;
        model.addAttribute(<span class="hljs-string">"picture"</span>,<span class="hljs-keyword">new</span> Picture());
        <span class="hljs-keyword">return</span> <span class="hljs-string">"admin/pictures-input"</span>;
    &#125;
    <span class="hljs-comment">//照片新增</span>
    <span class="hljs-meta">@PostMapping</span>(<span class="hljs-string">"/pictures"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">post</span><span class="hljs-params">(Picture picture, BindingResult result, RedirectAttributes attributes)</span></span>&#123;
        <span class="hljs-keyword">if</span>(result.hasErrors())&#123;
            <span class="hljs-keyword">return</span> <span class="hljs-string">"admin/pictures-input"</span>;
        &#125;
        <span class="hljs-keyword">int</span> p = pictureService.savePicture(picture);
        <span class="hljs-keyword">if</span>(p == <span class="hljs-number">0</span>)&#123;
            attributes.addFlashAttribute(<span class="hljs-string">"message"</span>,<span class="hljs-string">"新增失败"</span>);
        &#125;<span class="hljs-keyword">else</span>&#123;
            attributes.addFlashAttribute(<span class="hljs-string">"message"</span>,<span class="hljs-string">"新增成功"</span>);
        &#125;
        <span class="hljs-keyword">return</span> <span class="hljs-string">"redirect:/admin/pictures"</span>;
    &#125;
    <span class="hljs-comment">//跳转到编辑页面</span>
    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/pictures/&#123;id&#125;/input"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">editInput</span><span class="hljs-params">(@PathVariable Long id,Model model)</span></span>&#123;
        model.addAttribute(<span class="hljs-string">"picture"</span>,pictureService.getPicture(id));
        <span class="hljs-keyword">return</span> <span class="hljs-string">"admin/pictures-input"</span>;
    &#125;
    <span class="hljs-comment">//照片编辑</span>
    <span class="hljs-meta">@PostMapping</span>(<span class="hljs-string">"/pictures/&#123;id&#125;"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">editPost</span><span class="hljs-params">(Picture picture,RedirectAttributes attributes)</span></span>&#123;
        <span class="hljs-keyword">int</span> p = pictureService.updatePicture(picture);
        <span class="hljs-keyword">if</span>(p == <span class="hljs-number">0</span>)&#123;
            attributes.addFlashAttribute(<span class="hljs-string">"message"</span>,<span class="hljs-string">"编辑失败"</span>);
        &#125;<span class="hljs-keyword">else</span>&#123;
            attributes.addFlashAttribute(<span class="hljs-string">"message"</span>,<span class="hljs-string">"编辑成功"</span>);
        &#125;
        <span class="hljs-keyword">return</span> <span class="hljs-string">"redirect:/admin/pictures"</span>;
    &#125;
    <span class="hljs-comment">//删除照片</span>
    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/pictures/&#123;id&#125;/delete"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">delete</span><span class="hljs-params">(@PathVariable Long id,RedirectAttributes attributes)</span></span>&#123;
        pictureService.deletePicture(id);
        attributes.addFlashAttribute(<span class="hljs-string">"message"</span>,<span class="hljs-string">"删除成功"</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-string">"redirect:/admin/pictures"</span>;
    &#125;
&#125;</code></pre>



<h2 id="10-博客首页显示"><a href="#10-博客首页显示" class="headerlink" title="10. 博客首页显示"></a>10. 博客首页显示</h2><h3 id="功能分析："><a href="#功能分析：" class="headerlink" title="功能分析："></a>功能分析：</h3><ul>
<li>查询最新文章列表</li>
<li>查询最新推荐文章</li>
<li>搜索功能(根据关键字搜索功能)</li>
<li>统计博客信息<ul>
<li>博客总数</li>
<li>访问总数</li>
<li>评论总数</li>
<li>留言总数</li>
</ul>
</li>
</ul>
<h3 id="功能实现思路"><a href="#功能实现思路" class="headerlink" title="功能实现思路"></a>功能实现思路</h3><ul>
<li>查询最新文章列表：定义一个实体类来查询文章列表信息，并定义相应接口实现查询</li>
<li>查询最新推荐文章：定义一个实体类来查询推荐文章信息，定义相应接口实现查询</li>
<li>搜索博客：显示的还是列表博客，因此用文章列表信息的实体类，定义一个接口实现搜索</li>
<li>统计博客：定义接口关联SQL来实现统计博客信息</li>
</ul>
<h3 id="定义实体类：1-最新博客实体类-2-最新推荐实体类"><a href="#定义实体类：1-最新博客实体类-2-最新推荐实体类" class="headerlink" title="定义实体类：1. 最新博客实体类 2. 最新推荐实体类"></a>定义实体类：1. 最新博客实体类 2. 最新推荐实体类</h3><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.star.entity;

<span class="hljs-keyword">import</span> lombok.Data;

<span class="hljs-keyword">import</span> java.util.Date;

<span class="hljs-comment">/**</span>
<span class="hljs-comment"> * 首页博客信息实体类</span>
<span class="hljs-comment"> */</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FirstPageBlog</span> </span>&#123;

    <span class="hljs-comment">//博客信息</span>
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String title;
    <span class="hljs-keyword">private</span> String firstPicture;
    <span class="hljs-keyword">private</span> Integer views;
    <span class="hljs-keyword">private</span> Integer commentCount;
    <span class="hljs-keyword">private</span> Date updateTime;
    <span class="hljs-keyword">private</span> String description;

    <span class="hljs-comment">//分类名称</span>
    <span class="hljs-keyword">private</span> String typeName;

    <span class="hljs-comment">//用户名</span>
    <span class="hljs-keyword">private</span> String nickname;

    <span class="hljs-comment">//用户头像</span>
    <span class="hljs-keyword">private</span> String avatar;
&#125;</code></pre>

<pre><code class="hljs java"><span class="hljs-keyword">package</span> com.star.entity;

<span class="hljs-keyword">import</span> lombok.Data;

<span class="hljs-comment">/**</span>
<span class="hljs-comment"> * 推荐博客数据实体类</span>
<span class="hljs-comment"> */</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RecommendBlog</span> </span>&#123;
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String title;
    <span class="hljs-keyword">private</span> String firstPicture;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> recommend;
&#125;</code></pre>



<h3 id="持久层接口"><a href="#持久层接口" class="headerlink" title="持久层接口"></a>持久层接口</h3><pre><code class="hljs java"><span class="hljs-comment">//查询首页最新博客列表信息</span>
<span class="hljs-function">List&lt;FirstPageBlog&gt; <span class="hljs-title">getFirstPageBlog</span><span class="hljs-params">()</span></span>;

<span class="hljs-comment">//查询首页最新推荐信息</span>
<span class="hljs-function">List&lt;RecommendBlog&gt; <span class="hljs-title">getAllRecommendBlog</span><span class="hljs-params">()</span></span>;

<span class="hljs-comment">//搜索博客列表</span>
<span class="hljs-function">List&lt;FirstPageBlog&gt; <span class="hljs-title">getSearchBlog</span><span class="hljs-params">(String query)</span></span>;

<span class="hljs-comment">//统计博客总数</span>
<span class="hljs-function">Integer <span class="hljs-title">getBlogTotal</span><span class="hljs-params">()</span></span>;

<span class="hljs-comment">//统计访问总数</span>
<span class="hljs-function">Integer <span class="hljs-title">getBlogViewTotal</span><span class="hljs-params">()</span></span>;

<span class="hljs-comment">//统计评论总数</span>
<span class="hljs-function">Integer <span class="hljs-title">getBlogCommentTotal</span><span class="hljs-params">()</span></span>;

<span class="hljs-comment">//统计留言总数</span>
<span class="hljs-function">Integer <span class="hljs-title">getBlogMessageTotal</span><span class="hljs-params">()</span></span>;</code></pre>



<h3 id="xml文件-2"><a href="#xml文件-2" class="headerlink" title="xml文件"></a>xml文件</h3><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--查询首页最新博客列表信息--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"firstPageBlog"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"com.star.queryvo.FirstPageBlog"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"id"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"id"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"title"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"title"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"firstPicture"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"first_picture"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"views"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"views"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"commentCount"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"comment_count"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"createTime"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"create_time"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"updateTime"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"update_time"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"description"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"description"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"typeName"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"name"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"nickname"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"nickname"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"avatar"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"avatar"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"getFirstPageBlog"</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">"firstPageBlog"</span>&gt;</span>
    select b.id,b.title,b.first_picture, b.views, b.comment_count,b.create_time,b.update_time,b.description,
    t.name ,
    u.nickname, u.avatar
    from myblog.t_blog b, myblog.t_type t,myblog.t_user u
    where b.type_id = t.id and  u.id = b.user_id order by b.create_time desc
<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>

<span class="hljs-comment">&lt;!--查询推荐文章--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"getAllRecommendBlog"</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">"com.star.queryvo.RecommendBlog"</span>&gt;</span>
    select * from myblog.t_blog where t_blog.recommend = true order by t_blog.create_time desc limit 4;
<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>

<span class="hljs-comment">&lt;!--搜索文章--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"getSearchBlog"</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">"firstPageBlog"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bind</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"pattern"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"'%' + query + '%'"</span> /&gt;</span>
    select b.id,b.title,b.first_picture, b.views,b.comment_count,b.update_time,b.description,
    t.name ,
    u.nickname, u.avatar
    from myblog.t_blog b, myblog.t_type t,myblog.t_user u
    where b.type_id = t.id and  u.id = b.user_id and (b.title like #&#123;pattern&#125; or b.content like  #&#123;pattern&#125;)
    order by b.update_time desc
<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>

<span class="hljs-comment">&lt;!--统计博客信息--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"getBlogTotal"</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">"Integer"</span>&gt;</span>
    select count(*) from myblog.t_blog
<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"getBlogViewTotal"</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">"Integer"</span>&gt;</span>
    select coalesce (sum(views),0) from myblog.t_blog
<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"getBlogCommentTotal"</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">"Integer"</span>&gt;</span>
    select count(*) from myblog.t_comment
<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"getBlogMessageTotal"</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">"Integer"</span>&gt;</span>
    select count(*) from myblog.t_message
<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre>



<p><strong>注意：SQL语句有一个需要注意的地方</strong></p>
<ul>
<li>搜索文章使用的是模糊查询</li>
<li>本来使用的统计访问总数的SQL语句是 <code>select sum(views) from myblog.t_blog</code></li>
<li>发现当sum求和返回为null的时候，会报空指针异常</li>
<li>所以改用 <code>coalesce(sum(views),0)</code>,当sum求和为null的时候赋为0</li>
</ul>
<h3 id="Service及Impl-2"><a href="#Service及Impl-2" class="headerlink" title="Service及Impl"></a>Service及Impl</h3><pre><code class="hljs java"><span class="hljs-comment">//查询首页最新博客列表信息</span>
<span class="hljs-function">List&lt;FirstPageBlog&gt; <span class="hljs-title">getAllFirstPageBlog</span><span class="hljs-params">()</span></span>;

<span class="hljs-comment">//查询首页最新推荐信息</span>
<span class="hljs-function">List&lt;RecommendBlog&gt; <span class="hljs-title">getRecommendedBlog</span><span class="hljs-params">()</span></span>;

<span class="hljs-comment">//搜索博客列表</span>
<span class="hljs-function">List&lt;FirstPageBlog&gt; <span class="hljs-title">getSearchBlog</span><span class="hljs-params">(String query)</span></span>;

<span class="hljs-comment">//统计博客总数</span>
<span class="hljs-function">Integer <span class="hljs-title">getBlogTotal</span><span class="hljs-params">()</span></span>;

<span class="hljs-comment">//统计访问总数</span>
<span class="hljs-function">Integer <span class="hljs-title">getBlogViewTotal</span><span class="hljs-params">()</span></span>;

<span class="hljs-comment">//统计评论总数</span>
<span class="hljs-function">Integer <span class="hljs-title">getBlogCommentTotal</span><span class="hljs-params">()</span></span>;

<span class="hljs-comment">//统计留言总数</span>
<span class="hljs-function">Integer <span class="hljs-title">getBlogMessageTotal</span><span class="hljs-params">()</span></span>;</code></pre>

<pre><code class="hljs java"><span class="hljs-comment">//查询首页最新博客列表信息</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;FirstPageBlog&gt; <span class="hljs-title">getAllFirstPageBlog</span><span class="hljs-params">()</span> </span>&#123;
    <span class="hljs-keyword">return</span> blogDao.getFirstPageBlog();
&#125;

<span class="hljs-comment">//查询首页最新推荐信息</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;RecommendBlog&gt; <span class="hljs-title">getRecommendedBlog</span><span class="hljs-params">()</span> </span>&#123;
    List&lt;RecommendBlog&gt; allRecommendBlog = blogDao.getAllRecommendBlog();
    <span class="hljs-keyword">return</span> allRecommendBlog;
&#125;

<span class="hljs-comment">//搜索博客列表</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;FirstPageBlog&gt; <span class="hljs-title">getSearchBlog</span><span class="hljs-params">(String query)</span> </span>&#123;
    <span class="hljs-keyword">return</span> blogDao.getSearchBlog(query);
&#125;

<span class="hljs-comment">//统计博客总数</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">getBlogTotal</span><span class="hljs-params">()</span> </span>&#123;
    <span class="hljs-keyword">return</span> blogDao.getBlogTotal();
&#125;

<span class="hljs-comment">//统计访问总数</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">getBlogViewTotal</span><span class="hljs-params">()</span> </span>&#123;
    <span class="hljs-keyword">return</span> blogDao.getBlogViewTotal();
&#125;

<span class="hljs-comment">//统计评论总数</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">getBlogCommentTotal</span><span class="hljs-params">()</span> </span>&#123;
    <span class="hljs-keyword">return</span> blogDao.getBlogCommentTotal();
&#125;

<span class="hljs-comment">//统计留言总数</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">getBlogMessageTotal</span><span class="hljs-params">()</span> </span>&#123;
    <span class="hljs-keyword">return</span> blogDao.getBlogMessageTotal();
&#125;</code></pre>



<h3 id="Controller-1"><a href="#Controller-1" class="headerlink" title="Controller"></a>Controller</h3><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.star.controller;


<span class="hljs-keyword">import</span> com.github.pagehelper.PageHelper;
<span class="hljs-keyword">import</span> com.github.pagehelper.PageInfo;
<span class="hljs-keyword">import</span> com.star.entity.DetailBlog;
<span class="hljs-keyword">import</span> com.star.entity.FirstPageBlog;
<span class="hljs-keyword">import</span> com.star.entity.RecommendBlog;
<span class="hljs-keyword">import</span> com.star.service.BlogService;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Controller;
<span class="hljs-keyword">import</span> org.springframework.ui.Model;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.*;
<span class="hljs-keyword">import</span> org.springframework.web.servlet.mvc.support.RedirectAttributes;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-comment">/**</span>
<span class="hljs-comment"> * 首页控制器</span>
<span class="hljs-comment"> */</span>
<span class="hljs-meta">@Controller</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">IndexController</span> </span>&#123;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> BlogService blogService;

    <span class="hljs-comment">//分页查询博客列表</span>
    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">index</span><span class="hljs-params">(Model model, @RequestParam(defaultValue = <span class="hljs-string">"1"</span>,value = <span class="hljs-string">"pageNum"</span>)</span>Integer pageNum,</span>
<span class="hljs-function">                        RedirectAttributes attributes)</span>&#123;
        PageHelper.startPage(pageNum,<span class="hljs-number">10</span>);
        List&lt;FirstPageBlog&gt; firstPageBlogs = blogService.getFirstPageBlog();
        List&lt;RecommendBlog&gt; recommendBlogs = blogService.getAllRecommendBlog();
        PageInfo&lt;FirstPageBlog&gt; pageInfo = <span class="hljs-keyword">new</span> PageInfo&lt;&gt;(firstPageBlogs);
        model.addAttribute(<span class="hljs-string">"pageInfo"</span>,pageInfo);
        model.addAttribute(<span class="hljs-string">"recommendedBlogs"</span>,recommendBlogs);
        <span class="hljs-keyword">return</span> <span class="hljs-string">"index"</span>;
    &#125;

    <span class="hljs-comment">//搜索博客</span>
    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"search"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">search</span><span class="hljs-params">(Model model,</span></span>
<span class="hljs-function"><span class="hljs-params">                         @RequestParam(defaultValue = <span class="hljs-string">"1"</span>,value = <span class="hljs-string">"pageNum"</span>)</span>Integer pageNum,</span>
<span class="hljs-function">                         @RequestParam String query)</span>&#123;
        PageHelper.startPage(pageNum,<span class="hljs-number">1000</span>);
        List&lt;FirstPageBlog&gt; firstPageBlogs = blogService.getFirstPageBlog();

        PageInfo&lt;FirstPageBlog&gt; pageInfo = <span class="hljs-keyword">new</span> PageInfo&lt;&gt;(firstPageBlogs);
        model.addAttribute(<span class="hljs-string">"pageInfo"</span>,pageInfo);
        model.addAttribute(<span class="hljs-string">"query"</span>,query);
        <span class="hljs-keyword">return</span> <span class="hljs-string">"search"</span>;
    &#125;

    <span class="hljs-comment">//博客信息统计</span>
    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"footer/blogmessage"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">blogMessage</span><span class="hljs-params">(Model model)</span></span>&#123;
        <span class="hljs-keyword">int</span> blogTotal = blogService.getBlogTotal();
        <span class="hljs-keyword">int</span> blogViewTotal = blogService.getBlogViewTotal();
        <span class="hljs-keyword">int</span> blogCommentTotal = blogService.getBlogCommentTotal();
        <span class="hljs-keyword">int</span> blogMessageTotal = blogService.getBlogMessageTotal();

        model.addAttribute(<span class="hljs-string">"blogTotal"</span>,blogTotal);
        model.addAttribute(<span class="hljs-string">"blogViewTotal"</span>,blogViewTotal);
        model.addAttribute(<span class="hljs-string">"blogCommentTotal"</span>,blogCommentTotal);
        model.addAttribute(<span class="hljs-string">"blogMessageTotal"</span>,blogMessageTotal);

        <span class="hljs-keyword">return</span> <span class="hljs-string">"index :: blogMessage"</span>;
    &#125;

    <span class="hljs-comment">//跳转博客详细界面</span>
    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/blog/&#123;id&#125;"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">blog</span><span class="hljs-params">(@PathVariable Long id,Model model)</span></span>&#123;
        DetailBlog detailBlog = blogService.getDetailedBlog(id);
        model.addAttribute(<span class="hljs-string">"blog"</span>,detailBlog);
        <span class="hljs-keyword">return</span> <span class="hljs-string">"blog"</span>;
    &#125;
&#125;</code></pre>



<h2 id="11-博客详情页面显示"><a href="#11-博客详情页面显示" class="headerlink" title="11. 博客详情页面显示"></a>11. 博客详情页面显示</h2><h3 id="功能分析：-1"><a href="#功能分析：-1" class="headerlink" title="功能分析："></a>功能分析：</h3><ul>
<li>文章内容<ul>
<li>跳转博客详情界面，返回文章详情和评论内容</li>
</ul>
</li>
<li>评论内容</li>
</ul>
<h3 id="博客详情实体类，需要有博客信息和类型信息"><a href="#博客详情实体类，需要有博客信息和类型信息" class="headerlink" title="博客详情实体类，需要有博客信息和类型信息"></a>博客详情实体类，需要有博客信息和类型信息</h3><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.star.entity;

<span class="hljs-keyword">import</span> lombok.Data;

<span class="hljs-keyword">import</span> java.util.Date;

<span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DetailBlog</span> </span>&#123;
    <span class="hljs-comment">//博客信息</span>
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String firstPicture;
    <span class="hljs-keyword">private</span> String flag;
    <span class="hljs-keyword">private</span> String title;
    <span class="hljs-keyword">private</span> String content;
    <span class="hljs-keyword">private</span> Integer views;
    <span class="hljs-keyword">private</span> Integer commentCount;
    <span class="hljs-keyword">private</span> Date updateTime;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> commentabled;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> shareStatement;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> appreciation;
    <span class="hljs-keyword">private</span> String nickname;
    <span class="hljs-keyword">private</span> String avatar;
    <span class="hljs-comment">//分类名称</span>
    <span class="hljs-keyword">private</span> String typeName;
&#125;</code></pre>

<h3 id="添加MarkDown编辑器工具类"><a href="#添加MarkDown编辑器工具类" class="headerlink" title="添加MarkDown编辑器工具类"></a>添加MarkDown编辑器工具类</h3><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.atlassian.commonmark<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commonmark<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.10.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.atlassian.commonmark<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commonmark-ext-heading-anchor<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.10.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.atlassian.commonmark<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commonmark-ext-gfm-tables<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.10.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>

<pre><code class="hljs java"><span class="hljs-keyword">package</span> com.star.util;

<span class="hljs-keyword">import</span> org.commonmark.Extension;
<span class="hljs-keyword">import</span> org.commonmark.ext.gfm.tables.TableBlock;
<span class="hljs-keyword">import</span> org.commonmark.ext.gfm.tables.TablesExtension;
<span class="hljs-keyword">import</span> org.commonmark.ext.heading.anchor.HeadingAnchorExtension;
<span class="hljs-keyword">import</span> org.commonmark.node.Link;
<span class="hljs-keyword">import</span> org.commonmark.node.Node;
<span class="hljs-keyword">import</span> org.commonmark.parser.Parser;
<span class="hljs-keyword">import</span> org.commonmark.renderer.html.AttributeProvider;
<span class="hljs-keyword">import</span> org.commonmark.renderer.html.AttributeProviderContext;
<span class="hljs-keyword">import</span> org.commonmark.renderer.html.AttributeProviderFactory;
<span class="hljs-keyword">import</span> org.commonmark.renderer.html.HtmlRenderer;

<span class="hljs-keyword">import</span> java.util.*;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MarkdownUtils</span> </span>&#123;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">markdownToHtml</span><span class="hljs-params">(String markdown)</span> </span>&#123;
        Parser parser = Parser.builder().build();
        Node document = parser.parse(markdown);
        HtmlRenderer renderer = HtmlRenderer.builder().build();
        <span class="hljs-keyword">return</span> renderer.render(document);
    &#125;

    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * 增加扩展[标题锚点，表格生成]</span>
<span class="hljs-comment">     * Markdown转换成HTML</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> markdown</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment">     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">markdownToHtmlExtensions</span><span class="hljs-params">(String markdown)</span> </span>&#123;
        <span class="hljs-comment">//h标题生成id</span>
        Set&lt;Extension&gt; headingAnchorExtensions = Collections.singleton(HeadingAnchorExtension.create());
        <span class="hljs-comment">//转换table的HTML</span>
        List&lt;Extension&gt; tableExtension = Arrays.asList(TablesExtension.create());
        Parser parser = Parser.builder()
                .extensions(tableExtension)
                .build();
        Node document = parser.parse(markdown);
        HtmlRenderer renderer = HtmlRenderer.builder()
                .extensions(headingAnchorExtensions)
                .extensions(tableExtension)
                .attributeProviderFactory(<span class="hljs-keyword">new</span> AttributeProviderFactory() &#123;
                    <span class="hljs-function"><span class="hljs-keyword">public</span> AttributeProvider <span class="hljs-title">create</span><span class="hljs-params">(AttributeProviderContext context)</span> </span>&#123;
                        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> CustomAttributeProvider();
                    &#125;
                &#125;)
                .build();
        <span class="hljs-keyword">return</span> renderer.render(document);
    &#125;

    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * 处理标签的属性</span>
<span class="hljs-comment">     */</span>
    <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomAttributeProvider</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">AttributeProvider</span> </span>&#123;
        <span class="hljs-meta">@Override</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setAttributes</span><span class="hljs-params">(Node node, String tagName, Map&lt;String, String&gt; attributes)</span> </span>&#123;
            <span class="hljs-comment">//改变a标签的target属性为_blank</span>
            <span class="hljs-keyword">if</span> (node <span class="hljs-keyword">instanceof</span> Link) &#123;
                attributes.put(<span class="hljs-string">"target"</span>, <span class="hljs-string">"_blank"</span>);
            &#125;
            <span class="hljs-keyword">if</span> (node <span class="hljs-keyword">instanceof</span> TableBlock) &#123;
                attributes.put(<span class="hljs-string">"class"</span>, <span class="hljs-string">"ui celled table"</span>);
            &#125;
        &#125;
    &#125;

&#125;</code></pre>



<h3 id="持久层接口：详情显示"><a href="#持久层接口：详情显示" class="headerlink" title="持久层接口：详情显示"></a>持久层接口：详情显示</h3><pre><code class="hljs java"><span class="hljs-comment">//查询博客详情</span>
<span class="hljs-function">DetailedBlog <span class="hljs-title">getDetailedBlog</span><span class="hljs-params">(Long id)</span></span>;

<span class="hljs-comment">//文章访问更新</span>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">updateViews</span><span class="hljs-params">(Long id)</span></span>;

<span class="hljs-comment">//根据博客id查询出评论数量</span>
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">getCommentCountById</span><span class="hljs-params">(Long id)</span></span>;</code></pre>



<h3 id="xml文件-3"><a href="#xml文件-3" class="headerlink" title="xml文件"></a>xml文件</h3><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"detailedBlog"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"com.star.queryvo.DetailedBlog"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"id"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"bid"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"firstPicture"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"first_picture"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"flag"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"flag"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"title"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"title"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"content"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"content"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"typeName"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"name"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"views"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"views"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"commentCount"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"comment_count"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"updateTime"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"update_time"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"commentabled"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"commentabled"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"shareStatement"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"share_statement"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"appreciation"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"appreciation"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"nickname"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"nickname"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"avatar"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"avatar"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span>

<span class="hljs-comment">&lt;!--博客详情查询--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"getDetailedBlog"</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">"detailedBlog"</span>&gt;</span>
    select b.id 			 bid,b.first_picture,b.flag,b.title,b.content,b.views,b.comment_count,b.update_time,b.commentabled,b.share_statement,b.appreciation,    u.nickname,u.avatar,t.name
    from myblog.t_blog b,myblog.t_user u, myblog.t_type t
    where b.user_id = u.id and b.type_id = t.id and b.id = #&#123;id&#125;
<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>

<span class="hljs-comment">&lt;!--文章访问自增--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">update</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"updateViews"</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">"com.star.entity.Blog"</span>&gt;</span>
    update myblog.t_blog b set b.views = b.views+1 where b.id = #&#123;id&#125;
<span class="hljs-tag">&lt;/<span class="hljs-name">update</span>&gt;</span>

<span class="hljs-comment">&lt;!--查询出文章评论数量并更新--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">update</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"getCommentCountById"</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">"com.star.entity.Blog"</span>&gt;</span>
    update myblog.t_blog b set b.comment_count = (
    select count(*) from myblog.t_comment c where c.blog_id = #&#123;id&#125; and b.id = #&#123;id&#125;
    ) WHERE b.id = #&#123;id&#125;
<span class="hljs-tag">&lt;/<span class="hljs-name">update</span>&gt;</span></code></pre>



<h3 id="持久层接口：添加博客"><a href="#持久层接口：添加博客" class="headerlink" title="持久层接口：添加博客"></a>持久层接口：添加博客</h3><p>添加博客，访问数量自增，评论数更新</p>
<pre><code class="hljs java"><span class="hljs-comment">//查询博客详情</span>
<span class="hljs-function">DetailedBlog <span class="hljs-title">getDetailedBlog</span><span class="hljs-params">(Long id)</span></span>;</code></pre>



<h3 id="ServiceImpl新增实现类"><a href="#ServiceImpl新增实现类" class="headerlink" title="ServiceImpl新增实现类"></a>ServiceImpl新增实现类</h3><pre><code class="hljs java"><span class="hljs-meta">@Override</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> DetailedBlog <span class="hljs-title">getDetailedBlog</span><span class="hljs-params">(Long id)</span> </span>&#123;
    DetailedBlog detailedBlog = blogDao.getDetailedBlog(id);
    <span class="hljs-keyword">if</span> (detailedBlog == <span class="hljs-keyword">null</span>) &#123;
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NotFoundException(<span class="hljs-string">"该博客不存在"</span>);
    &#125;
    String content = detailedBlog.getContent();
    detailedBlog.setContent(MarkdownUtils.markdownToHtmlExtensions(content));
    <span class="hljs-comment">//文章访问数量自增</span>
    blogDao.updateViews(id);
    <span class="hljs-comment">//文章评论数量更新</span>
    blogDao.getCommentCountById(id);
    <span class="hljs-keyword">return</span> detailedBlog;
&#125;</code></pre>



<h3 id="Controller-2"><a href="#Controller-2" class="headerlink" title="Controller"></a>Controller</h3><pre><code class="hljs java"><span class="hljs-comment">//跳转博客详情页面</span>
<span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/blog/&#123;id&#125;"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">blog</span><span class="hljs-params">(@PathVariable Long id, Model model)</span> </span>&#123;
    DetailedBlog detailedBlog = blogService.getDetailedBlog(id);
    model.addAttribute(<span class="hljs-string">"blog"</span>, detailedBlog);
    <span class="hljs-keyword">return</span> <span class="hljs-string">"blog"</span>;
&#125;</code></pre>



<h2 id="12-其他页面显示"><a href="#12-其他页面显示" class="headerlink" title="12. 其他页面显示"></a>12. 其他页面显示</h2><h3 id="功能分析：-2"><a href="#功能分析：-2" class="headerlink" title="功能分析："></a>功能分析：</h3><ul>
<li>查询出所有分类</li>
<li>查询出该分类下的文章数目</li>
</ul>
<h3 id="持久层"><a href="#持久层" class="headerlink" title="持久层"></a>持久层</h3><pre><code class="hljs java"><span class="hljs-comment">//查询所有分类	TypeDao</span>
<span class="hljs-function">List&lt;Type&gt; <span class="hljs-title">getAllTypeAndBlog</span><span class="hljs-params">()</span></span>;</code></pre>

<pre><code class="hljs java"><span class="hljs-comment">//根据TypeId查询博客列表，显示在分类页面	BlogDao</span>
<span class="hljs-function">List&lt;FirstPageBlog&gt; <span class="hljs-title">getByTypeId</span><span class="hljs-params">(Long typeId)</span></span>;</code></pre>



<h3 id="xml文件-4"><a href="#xml文件-4" class="headerlink" title="xml文件"></a>xml文件</h3><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"type"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"com.star.entity.Type"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"id"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"tid"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"name"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"name"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">collection</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"blogs"</span> <span class="hljs-attr">ofType</span>=<span class="hljs-string">"com.star.entity.Blog"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"id"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"bid"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"title"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"title"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"typeId"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"type_id"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">collection</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span>
<span class="hljs-comment">&lt;!--查询分类--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"getAllTypeAndBlog"</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">"type"</span>&gt;</span>
    select t.id tid, t.name, b.id bid, b.title,b.type_id
    from myblog.t_type t,myblog.t_blog b
    where t.id = b.type_id
<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre>

<pre><code class="hljs xml"><span class="hljs-comment">&lt;!--根据TypeId查询博客列表，显示在分类页面--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"getByTypeId"</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">"firstPageBlog"</span>&gt;</span>
    select b.id,b.title,b.first_picture, b.views, b.comment_count, b.update_time, b.description,t.name ,u.nickname, u.avatar
    from myblog.t_blog b, myblog.t_type t,myblog.t_user u
    where b.type_id = t.id and u.id = b.user_id and b.type_id = #&#123;typeId&#125; order by b.update_time desc
<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre>



<h3 id="业务层"><a href="#业务层" class="headerlink" title="业务层"></a>业务层</h3><pre><code class="hljs java"><span class="hljs-meta">@Transactional</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Type&gt; <span class="hljs-title">getAllTypeAndBlog</span><span class="hljs-params">()</span> </span>&#123;
    <span class="hljs-keyword">return</span> typeDao.getAllTypeAndBlog();
&#125;</code></pre>

<pre><code class="hljs java"><span class="hljs-comment">//分类页面查询</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;FirstPageBlog&gt; <span class="hljs-title">getByTypeId</span><span class="hljs-params">(Long typeId)</span> </span>&#123;
    <span class="hljs-keyword">return</span> blogDao.getByTypeId(typeId);
&#125;</code></pre>



<h3 id="Controller-3"><a href="#Controller-3" class="headerlink" title="Controller"></a>Controller</h3><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.star.controller;

<span class="hljs-keyword">import</span> com.github.pagehelper.PageHelper;
<span class="hljs-keyword">import</span> com.github.pagehelper.PageInfo;
<span class="hljs-keyword">import</span> com.star.entity.Type;
<span class="hljs-keyword">import</span> com.star.queryvo.FirstPageBlog;
<span class="hljs-keyword">import</span> com.star.service.BlogService;
<span class="hljs-keyword">import</span> com.star.service.TypeService;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Controller;
<span class="hljs-keyword">import</span> org.springframework.ui.Model;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.PathVariable;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestParam;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-comment">/**</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@Description</span>: 分类页面控制器</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@Date</span>: Created in 10:03 2020/6/24</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@Author</span>: ONESTAR</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@QQ</span>群: 530311074</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@URL</span>: https://onestar.newstar.net.cn/</span>
<span class="hljs-comment"> */</span>
<span class="hljs-meta">@Controller</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TypeShowController</span> </span>&#123;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> TypeService typeService;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> BlogService blogService;

    <span class="hljs-comment">//    分页查询分类</span>
    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/types/&#123;id&#125;"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">types</span><span class="hljs-params">(@RequestParam(defaultValue = <span class="hljs-string">"1"</span>,value = <span class="hljs-string">"pageNum"</span>)</span> Integer pageNum, @PathVariable Long id, Model model) </span>&#123;
        List&lt;Type&gt; types = typeService.getAllTypeAndBlog();

        <span class="hljs-comment">//id为-1表示从首页导航栏点击进入分类页面</span>
        <span class="hljs-keyword">if</span> (id == -<span class="hljs-number">1</span>) &#123;
            id = types.get(<span class="hljs-number">0</span>).getId();
        &#125;
        model.addAttribute(<span class="hljs-string">"types"</span>, types);
        List&lt;FirstPageBlog&gt; blogs = blogService.getByTypeId(id);

        PageHelper.startPage(pageNum, <span class="hljs-number">10000</span>);
        PageInfo&lt;FirstPageBlog&gt; pageInfo = <span class="hljs-keyword">new</span> PageInfo&lt;&gt;(blogs);
        model.addAttribute(<span class="hljs-string">"pageInfo"</span>, pageInfo);
        model.addAttribute(<span class="hljs-string">"activeTypeId"</span>, id);
        <span class="hljs-keyword">return</span> <span class="hljs-string">"types"</span>;
    &#125;

&#125;</code></pre>



<h3 id="其他页面Controller层直接配置即可"><a href="#其他页面Controller层直接配置即可" class="headerlink" title="其他页面Controller层直接配置即可"></a>其他页面Controller层直接配置即可</h3><h3 id="时间轴"><a href="#时间轴" class="headerlink" title="时间轴"></a>时间轴</h3><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.star.controller;

<span class="hljs-keyword">import</span> com.star.queryvo.BlogQuery;
<span class="hljs-keyword">import</span> com.star.service.BlogService;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Controller;
<span class="hljs-keyword">import</span> org.springframework.ui.Model;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-comment">/**</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@Description</span>: 时间轴页面显示控制器</span>
<span class="hljs-comment"> */</span>
<span class="hljs-meta">@Controller</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ArchiveShowController</span> </span>&#123;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> BlogService blogService;

    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/archives"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">archive</span><span class="hljs-params">(Model model)</span></span>&#123;
        List&lt;BlogQuery&gt; blogs = blogService.getAllBlog();
        model.addAttribute(<span class="hljs-string">"blogs"</span>, blogs);
        <span class="hljs-keyword">return</span> <span class="hljs-string">"archives"</span>;
    &#125;

&#125;</code></pre>

<h3 id="音乐盒"><a href="#音乐盒" class="headerlink" title="音乐盒"></a>音乐盒</h3><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.star.controller;

<span class="hljs-keyword">import</span> org.springframework.stereotype.Controller;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;

<span class="hljs-comment">/**</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@Description</span>: 音乐盒页面显示控制器</span>
<span class="hljs-comment"> */</span>
<span class="hljs-meta">@Controller</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MusicShowController</span> </span>&#123;

    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/music"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">about</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> <span class="hljs-string">"music"</span>;
    &#125;

&#125;</code></pre>



<h4 id="友人帐"><a href="#友人帐" class="headerlink" title="友人帐"></a>友人帐</h4><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.star.controller;

<span class="hljs-keyword">import</span> com.star.service.FriendLinkService;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Controller;
<span class="hljs-keyword">import</span> org.springframework.ui.Model;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;

<span class="hljs-comment">/**</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@Description</span>: 友链显示控制器</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@Date</span>: Created in 21:12 2020/6/27</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@Author</span>: ONESTAR</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@QQ</span>群: 530311074</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@URL</span>: https://onestar.newstar.net.cn/</span>
<span class="hljs-comment"> */</span>
<span class="hljs-meta">@Controller</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FriendsShowController</span> </span>&#123;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> FriendLinkService friendLinkService;

    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/friends"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">friends</span><span class="hljs-params">(Model model)</span> </span>&#123;
        model.addAttribute(<span class="hljs-string">"friendlinks"</span>,friendLinkService.listFriendLink());
        <span class="hljs-keyword">return</span> <span class="hljs-string">"friends"</span>;
    &#125;

&#125;</code></pre>



<h3 id="照片墙"><a href="#照片墙" class="headerlink" title="照片墙"></a>照片墙</h3><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.star.controller;


<span class="hljs-keyword">import</span> com.star.service.PictureService;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Controller;
<span class="hljs-keyword">import</span> org.springframework.ui.Model;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;

<span class="hljs-meta">@Controller</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PictureShowController</span> </span>&#123;
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> PictureService pictureService;

    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/picture"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">pictures</span><span class="hljs-params">(Model model)</span></span>&#123;
        model.addAttribute(<span class="hljs-string">"pictures"</span>,pictureService.listPicture());
        <span class="hljs-keyword">return</span> <span class="hljs-string">"picture"</span>;
    &#125;
&#125;</code></pre>



<h3 id="关于我"><a href="#关于我" class="headerlink" title="关于我"></a>关于我</h3><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.star.controller;

<span class="hljs-keyword">import</span> org.springframework.stereotype.Controller;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;

<span class="hljs-meta">@Controller</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AboutShowController</span> </span>&#123;

    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/about"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">about</span><span class="hljs-params">()</span></span>&#123;
        <span class="hljs-keyword">return</span> <span class="hljs-string">"about"</span>;
    &#125;
&#125;</code></pre>





<h2 id="13-注册界面"><a href="#13-注册界面" class="headerlink" title="13. 注册界面"></a>13. 注册界面</h2><h3 id="功能分析：-3"><a href="#功能分析：-3" class="headerlink" title="功能分析："></a>功能分析：</h3><ul>
<li>需要有一个register页面来注册用户，而不是单纯的在本机数据库上添加用户</li>
<li>用户对应User类，存入数据库的密码应该是MD5加密以后的密码</li>
</ul>
<h3 id="功能实现"><a href="#功能实现" class="headerlink" title="功能实现"></a>功能实现</h3><ul>
<li>我们需要将前台用户输入的密码传输给后端，后端拿到密码后运行MD5加密</li>
<li>然后将加密后的密码存入数据库，每次用户登陆时，将用户输入的密码加密，与数据库中的密码比较</li>
</ul>
<h3 id="Dao层"><a href="#Dao层" class="headerlink" title="Dao层"></a>Dao层</h3><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment">* 返回插入是否成功 0/1</span>
<span class="hljs-comment">* <span class="hljs-doctag">@param</span> user  用户对线</span>
<span class="hljs-comment">* <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment">*/</span>
<span class="hljs-function"><span class="hljs-keyword">int</span>  <span class="hljs-title">insert</span><span class="hljs-params">(User user)</span></span>;</code></pre>



<h3 id="xml文件-5"><a href="#xml文件-5" class="headerlink" title="xml文件"></a>xml文件</h3><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"insert"</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">"com.star.entity.User"</span>&gt;</span>
    insert into myblog.t_user(avatar, create_time, email, nickname, password, type, update_time, username)
    values (#&#123;avatar&#125;,#&#123;createTime&#125;,#&#123;email&#125;,#&#123;nickname&#125;,#&#123;password&#125;,#&#123;type&#125;,#&#123;updateTime&#125;,#&#123;username&#125;);
<span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span></code></pre>



<h3 id="业务层-1"><a href="#业务层-1" class="headerlink" title="业务层"></a>业务层</h3><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">int</span>  <span class="hljs-title">insert</span><span class="hljs-params">(User user)</span></span>;</code></pre>

<pre><code class="hljs java"><span class="hljs-meta">@Override</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">insert</span><span class="hljs-params">(User user)</span> </span>&#123;
    user.setCreateTime(<span class="hljs-keyword">new</span> Date());
    user.setUpdateTime(<span class="hljs-keyword">new</span> Date());
    String realPassword = MD5Utils.code(user.getPassword());
    user.setPassword(realPassword);
    <span class="hljs-keyword">return</span> userDao.insert(user);
&#125;</code></pre>





<h3 id="Controller-4"><a href="#Controller-4" class="headerlink" title="Controller"></a>Controller</h3><pre><code class="hljs java"><span class="hljs-comment">//跳转到注册界面</span>
<span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/registerPage"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">registerPage</span><span class="hljs-params">()</span></span>&#123;
    <span class="hljs-keyword">return</span> <span class="hljs-string">"admin/register"</span>;
&#125;

<span class="hljs-comment">/**</span>
<span class="hljs-comment"> * 根据user对象，注册用户</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@param</span> user  user由前端传入部分，业务层设置时间</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment"> */</span>
<span class="hljs-meta">@PostMapping</span>(<span class="hljs-string">"/register"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">register</span><span class="hljs-params">(User user)</span></span>&#123;
    <span class="hljs-keyword">int</span> r = userService.insert(user);
    <span class="hljs-comment">//System.out.println(user.toString());</span>
    <span class="hljs-keyword">if</span>(r == <span class="hljs-number">0</span>)&#123;
       <span class="hljs-keyword">return</span> <span class="hljs-string">"error"</span>;
    &#125;<span class="hljs-keyword">else</span>&#123;
       <span class="hljs-keyword">return</span> <span class="hljs-string">"redirect:/admin"</span>;
    &#125;
&#125;</code></pre>





<h3 id="前端代码：register-html"><a href="#前端代码：register-html" class="headerlink" title="前端代码：register.html"></a>前端代码：register.html</h3><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">xmlns:th</span>=<span class="hljs-string">"http://www.w3.org/1999/xhtml"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">"@&#123;/layui/css/layui.css&#125;"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> /&gt;</span>
<span class="hljs-comment">&lt;!-- 你的HTML代码  th:action="@&#123;/admin/register&#125;" th:object="$&#123;user&#125;" method="post"--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>博客管理登录<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"../static/images/favicon.ico"</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">"@&#123;/images/me.jpg&#125;"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"icon"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"image/x-ico"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://cdn.jsdelivr.net/semantic-ui/2.2.4/semantic.min.css"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"../../static/css/me.css"</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">"@&#123;/css/me.css&#125;"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">"@&#123;/layui/css/layui.css&#125;"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"m-container-small m-padded-tb-massive"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"max-width: 30em !important;"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ur container"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ui middle aligned center aligned grid"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"column"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ui teal image header"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"content"</span>&gt;</span>
                        管理后台注册
                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>

                <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"layui-form"</span> <span class="hljs-attr">action</span>=<span class="hljs-string">"/admin/register"</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"post"</span> &gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"layui-form-item"</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"layui-form-label"</span>&gt;</span>用户名<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"layui-input-block"</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"username"</span> <span class="hljs-attr">required</span>  <span class="hljs-attr">lay-verify</span>=<span class="hljs-string">"required"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"请输入用户名"</span> <span class="hljs-attr">autocomplete</span>=<span class="hljs-string">"off"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"layui-input"</span>&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"layui-form-item"</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"layui-form-label"</span>&gt;</span>密码<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"layui-input-block"</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"password"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"password"</span> <span class="hljs-attr">required</span> <span class="hljs-attr">lay-verify</span>=<span class="hljs-string">"required"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"请输入密码"</span> <span class="hljs-attr">autocomplete</span>=<span class="hljs-string">"off"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"layui-input"</span>&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"layui-form-item"</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"layui-form-label"</span>&gt;</span>昵称<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"layui-input-block"</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"nickname"</span> <span class="hljs-attr">required</span>  <span class="hljs-attr">lay-verify</span>=<span class="hljs-string">"required"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"请输入用户名"</span> <span class="hljs-attr">autocomplete</span>=<span class="hljs-string">"off"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"layui-input"</span>&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"layui-form-item"</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"layui-form-label"</span>&gt;</span>邮箱<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"layui-input-block"</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"email"</span> <span class="hljs-attr">required</span>  <span class="hljs-attr">lay-verify</span>=<span class="hljs-string">"required"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"请输入邮箱"</span> <span class="hljs-attr">autocomplete</span>=<span class="hljs-string">"off"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"layui-input"</span>&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"layui-form-item"</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"layui-form-label"</span>&gt;</span>头像<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"layui-input-block"</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"avatar"</span> <span class="hljs-attr">required</span>  <span class="hljs-attr">lay-verify</span>=<span class="hljs-string">"required"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"请输入头像地址"</span> <span class="hljs-attr">autocomplete</span>=<span class="hljs-string">"off"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"layui-input"</span>&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"layui-form-item"</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"layui-form-label"</span>&gt;</span>类型<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"layui-input-block"</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"type"</span> <span class="hljs-attr">required</span>  <span class="hljs-attr">lay-verify</span>=<span class="hljs-string">"required"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"请输入类型"</span> <span class="hljs-attr">autocomplete</span>=<span class="hljs-string">"off"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"layui-input"</span>&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"layui-form-item"</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"layui-input-block"</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"layui-btn"</span> <span class="hljs-attr">lay-submit</span> <span class="hljs-attr">lay-filter</span>=<span class="hljs-string">"formDemo"</span>&gt;</span>立即提交<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"reset"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"layui-btn layui-btn-primary"</span>&gt;</span>重置<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>


                <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.jsdelivr.net/npm/jquery@3.2/dist/jquery.min.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.jsdelivr.net/semantic-ui/2.2.4/semantic.min.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">th:src</span>=<span class="hljs-string">"@&#123;/layui/layui.js&#125;"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span>
<span class="actionscript">    <span class="hljs-comment">//Demo</span></span>
<span class="actionscript">    layui.use(<span class="hljs-string">'form'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>&#123;</span>
<span class="actionscript">        <span class="hljs-keyword">var</span> form = layui.form;</span>
<span class="javascript">        <span class="hljs-built_in">console</span>.log(form);</span>
<span class="actionscript">        <span class="hljs-comment">//监听提交</span></span>
<span class="actionscript">        form.on(<span class="hljs-string">'submit(formDemo)'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data)</span></span>&#123;</span>
<span class="javascript">            <span class="hljs-keyword">var</span> message =  <span class="hljs-built_in">JSON</span>.stringify(data.field);</span>
<span class="actionscript">            <span class="hljs-keyword">var</span> $;</span>
<span class="javascript">            $.ajax(&#123;</span>
<span class="actionscript">                url:<span class="hljs-string">"/admin/register"</span>,</span>
<span class="javascript">                <span class="hljs-keyword">async</span>: <span class="hljs-literal">false</span>,</span>
<span class="actionscript">                type:<span class="hljs-string">"POST"</span>,</span>
<span class="actionscript">                contentType: <span class="hljs-string">"application/json"</span>,</span>
                data: message,
<span class="actionscript">                <span class="hljs-comment">// success: function(data)&#123;</span></span>
<span class="actionscript">                <span class="hljs-comment">//     console.log(123);</span></span>
<span class="actionscript">                <span class="hljs-comment">// &#125;</span></span>
            &#125;)
<span class="actionscript">            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</span>
        &#125;);
    &#125;);
<span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>


<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre>



<h2 id="14-邮箱注册"><a href="#14-邮箱注册" class="headerlink" title="14. 邮箱注册"></a>14. 邮箱注册</h2><h3 id="功能分析：-4"><a href="#功能分析：-4" class="headerlink" title="功能分析："></a>功能分析：</h3><ul>
<li>使用qq邮箱登陆，开启qq登陆的用户设置-账户-POP3服务-开启</li>
<li>得到一串字符串，放入application.yml中</li>
<li>引入相应的jar包，然后写出邮件传输的业务层代码</li>
<li>写出用户账户实体类，业务层，xml文件</li>
<li>实体类通过邮箱注册，status为0，代表未激活，status为1，代表已激活</li>
<li>用户需要通过点击链接激活</li>
<li>在LoginController中添加一层判断，取两个表中的并集作为账户</li>
</ul>
<h3 id="maven文件"><a href="#maven文件" class="headerlink" title="maven文件"></a>maven文件</h3><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--邮件--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-mail<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>

<h3 id="邮件发送业务层"><a href="#邮件发送业务层" class="headerlink" title="邮件发送业务层"></a>邮件发送业务层</h3><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.star.service;


<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">IMailService</span> </span>&#123;
    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * 发送文本邮件</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> to    收件人</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> subject   主题</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> content   内容</span>
<span class="hljs-comment">     */</span>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">sendSimpleMail</span><span class="hljs-params">(String to,String subject,String content)</span></span>;

    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * 发送HTML邮件</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> to    收件人</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> subject   主题</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> content   内容</span>
<span class="hljs-comment">     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sentHtmlMail</span><span class="hljs-params">(String to,String subject,String content)</span></span>;

    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * 发送带附件的邮件</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> to    收件人</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> subject   主题</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> content   内容</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> filePath  附件</span>
<span class="hljs-comment">     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sendAttachmentsMail</span><span class="hljs-params">(String to,String subject,String content,String filePath)</span></span>;

&#125;</code></pre>

<pre><code class="hljs java"><span class="hljs-keyword">package</span> com.star.service.impl;

<span class="hljs-keyword">import</span> com.star.service.IMailService;
<span class="hljs-keyword">import</span> org.slf4j.Logger;
<span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Value;
<span class="hljs-keyword">import</span> org.springframework.core.io.FileSystemResource;
<span class="hljs-keyword">import</span> org.springframework.mail.SimpleMailMessage;
<span class="hljs-keyword">import</span> org.springframework.mail.javamail.JavaMailSender;
<span class="hljs-keyword">import</span> org.springframework.mail.javamail.MimeMessageHelper;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;

<span class="hljs-keyword">import</span> javax.mail.MessagingException;
<span class="hljs-keyword">import</span> javax.mail.internet.MimeMessage;
<span class="hljs-keyword">import</span> java.io.File;
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">IMailServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">IMailService</span> </span>&#123;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Logger logger = LoggerFactory.getLogger(<span class="hljs-keyword">this</span>.getClass());

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> JavaMailSender mailSender;
    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * 配置文件中我的qq邮箱</span>
<span class="hljs-comment">     */</span>
    <span class="hljs-meta">@Value</span>(<span class="hljs-string">"$&#123;spring.mail.from&#125;"</span>)
    <span class="hljs-keyword">private</span> String from;

    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * 简单邮件</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> to    收件人</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> subject   主题</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> content   内容</span>
<span class="hljs-comment">     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sendSimpleMail</span><span class="hljs-params">(String to, String subject, String content)</span> </span>&#123;
        <span class="hljs-comment">//SimpleMailMessage对象</span>
        SimpleMailMessage message = <span class="hljs-keyword">new</span> SimpleMailMessage();
        <span class="hljs-comment">//邮件发送人</span>
        message.setFrom(from);
        <span class="hljs-comment">//邮件接收人</span>
        message.setTo(to);
        <span class="hljs-comment">//邮件主题</span>
        message.setSubject(subject);
        <span class="hljs-comment">//邮件内容</span>
        message.setText(content);
        <span class="hljs-comment">//发送邮件</span>
        mailSender.send(message);
    &#125;

    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * HTML邮件</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> to    收件人</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> subject   主题</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> content   内容</span>
<span class="hljs-comment">     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sentHtmlMail</span><span class="hljs-params">(String to, String subject, String content)</span> </span>&#123;
        MimeMessage message = mailSender.createMimeMessage();
        MimeMessageHelper messageHelper;
        <span class="hljs-keyword">try</span>&#123;
            messageHelper = <span class="hljs-keyword">new</span> MimeMessageHelper(message,<span class="hljs-keyword">true</span>);
            <span class="hljs-comment">//邮件发送人</span>
            messageHelper.setFrom(from);
            <span class="hljs-comment">//邮件接收人</span>
            messageHelper.setTo(to);
            <span class="hljs-comment">//邮件主题</span>
            message.setSubject(subject);
            <span class="hljs-comment">//邮件内容，html格式</span>
            messageHelper.setText(content, <span class="hljs-keyword">true</span>);
            <span class="hljs-comment">//发送</span>
            mailSender.send(message);
            <span class="hljs-comment">//日志信息</span>
            logger.info(<span class="hljs-string">"邮件已经发送。"</span>);
        &#125; <span class="hljs-keyword">catch</span> (MessagingException e) &#123;
            logger.error(<span class="hljs-string">"发送邮件时发生异常！"</span>, e);
        &#125;
    &#125;

    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * 带附件的邮件</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> to    收件人</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> subject   主题</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> content   内容</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> filePath  附件</span>
<span class="hljs-comment">     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sendAttachmentsMail</span><span class="hljs-params">(String to, String subject, String content, String filePath)</span> </span>&#123;
        MimeMessage message = mailSender.createMimeMessage();
        <span class="hljs-keyword">try</span> &#123;
            MimeMessageHelper helper = <span class="hljs-keyword">new</span> MimeMessageHelper(message, <span class="hljs-keyword">true</span>);
            helper.setFrom(from);
            helper.setTo(to);
            helper.setSubject(subject);
            helper.setText(content, <span class="hljs-keyword">true</span>);

            FileSystemResource file = <span class="hljs-keyword">new</span> FileSystemResource(<span class="hljs-keyword">new</span> File(filePath));
            String fileName = filePath.substring(filePath.lastIndexOf(File.separator));
            helper.addAttachment(fileName, file);
            mailSender.send(message);
            <span class="hljs-comment">//日志信息</span>
            logger.info(<span class="hljs-string">"邮件已经发送。"</span>);
        &#125; <span class="hljs-keyword">catch</span> (MessagingException e) &#123;
            logger.error(<span class="hljs-string">"发送邮件时发生异常！"</span>, e);
        &#125;
    &#125;
&#125;</code></pre>



<h3 id="用户实体类"><a href="#用户实体类" class="headerlink" title="用户实体类"></a>用户实体类</h3><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.star.entity;

<span class="hljs-keyword">import</span> lombok.Data;

<span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserMail</span> </span>&#123;
    <span class="hljs-keyword">private</span> Integer id;
    <span class="hljs-keyword">private</span> String username;
    <span class="hljs-keyword">private</span> String password;
    <span class="hljs-keyword">private</span> String useremail;
    <span class="hljs-keyword">private</span> Integer status;
    <span class="hljs-keyword">private</span> String code;
    <span class="hljs-keyword">private</span> String avatar;
&#125;</code></pre>



<h3 id="持久层-1"><a href="#持久层-1" class="headerlink" title="持久层"></a>持久层</h3><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.star.dao;

<span class="hljs-keyword">import</span> com.star.entity.UserMail;
<span class="hljs-keyword">import</span> org.apache.ibatis.annotations.Mapper;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Repository;

<span class="hljs-meta">@Mapper</span>
<span class="hljs-meta">@Repository</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserMailDao</span> </span>&#123;

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">register</span><span class="hljs-params">(UserMail userMail)</span></span>;

    <span class="hljs-function">UserMail <span class="hljs-title">checkCode</span><span class="hljs-params">(String code)</span></span>;

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">updateUserStatus</span><span class="hljs-params">(UserMail userMail)</span></span>;

    <span class="hljs-function">UserMail <span class="hljs-title">loginUserMail</span><span class="hljs-params">(UserMail userMail)</span></span>;
&#125;</code></pre>



<h3 id="业务层-2"><a href="#业务层-2" class="headerlink" title="业务层"></a>业务层</h3><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.star.service;

<span class="hljs-keyword">import</span> com.star.entity.UserMail;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserMailService</span> </span>&#123;
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">register</span><span class="hljs-params">(UserMail userMail)</span></span>;

    <span class="hljs-function">UserMail <span class="hljs-title">checkCode</span><span class="hljs-params">(String code)</span></span>;

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">updateUserStatus</span><span class="hljs-params">(UserMail userMail)</span></span>;

    <span class="hljs-function">UserMail <span class="hljs-title">loginUserMail</span><span class="hljs-params">(UserMail userMail)</span></span>;
&#125;</code></pre>

<pre><code class="hljs java"><span class="hljs-keyword">package</span> com.star.service.impl;

<span class="hljs-keyword">import</span> com.star.dao.UserMailDao;
<span class="hljs-keyword">import</span> com.star.entity.UserMail;
<span class="hljs-keyword">import</span> com.star.service.IMailService;
<span class="hljs-keyword">import</span> com.star.service.UserMailService;
<span class="hljs-keyword">import</span> com.star.util.MD5Utils;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserMailServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserMailService</span> </span>&#123;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> UserMailDao userMailDao;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> IMailService iMailService;
    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * 用户注册，同时发送一封激活邮件</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> userMail</span>
<span class="hljs-comment">     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">register</span><span class="hljs-params">(UserMail userMail)</span> </span>&#123;
        userMailDao.register(userMail);
        <span class="hljs-comment">//获取激活码</span>
        String code = userMail.getCode();
        System.out.println(<span class="hljs-string">"code: "</span>+code);
        <span class="hljs-comment">//主题</span>
        String subject = <span class="hljs-string">"来自博客的激活邮件"</span>;
        <span class="hljs-comment">//正文</span>
        String context = <span class="hljs-string">"&lt;a href=\"/mail/checkCode?code="</span>+code+<span class="hljs-string">"\"&gt;激活请点击:"</span>+code+<span class="hljs-string">"&lt;/a&gt;"</span>;
        <span class="hljs-comment">//发送</span>
        iMailService.sentHtmlMail(userMail.getUseremail(),subject,context);
    &#125;

    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * 根据激活码code进行查询用户，之后修改状态</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> code</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment">     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> UserMail <span class="hljs-title">checkCode</span><span class="hljs-params">(String code)</span> </span>&#123;
        <span class="hljs-keyword">return</span> userMailDao.checkCode(code);
    &#125;

    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * 激活账户，修改状态</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> userMail</span>
<span class="hljs-comment">     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">updateUserStatus</span><span class="hljs-params">(UserMail userMail)</span> </span>&#123;

        userMailDao.updateUserStatus(userMail);
    &#125;

    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * 登陆</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> userMail</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment">     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> UserMail <span class="hljs-title">loginUserMail</span><span class="hljs-params">(UserMail userMail)</span> </span>&#123;
        UserMail userMail1 = userMailDao.loginUserMail(userMail);
        <span class="hljs-keyword">if</span>(userMail1 != <span class="hljs-keyword">null</span>)&#123;
            <span class="hljs-keyword">return</span> userMail1;
        &#125;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
    &#125;
&#125;</code></pre>



<h3 id="xml文件-6"><a href="#xml文件-6" class="headerlink" title="xml文件"></a>xml文件</h3><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">mapper</span> <span class="hljs-meta-keyword">PUBLIC</span> <span class="hljs-meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span> <span class="hljs-meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span> &gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">"com.star.dao.UserMailDao"</span> &gt;</span>

    <span class="hljs-comment">&lt;!--注册用户--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"register"</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">"com.star.entity.UserMail"</span> &gt;</span>
    insert into myblog.t_usermail ( username, password,useremail,status,code)
    values (#&#123;username,jdbcType=VARCHAR&#125;, #&#123;password,jdbcType=VARCHAR&#125;, #&#123;useremail,jdbcType=VARCHAR&#125;,
      #&#123;status,jdbcType=INTEGER&#125;,#&#123;code,jdbcType=VARCHAR&#125;)
  <span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span>

    <span class="hljs-comment">&lt;!--根据激活码code查询用户--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"checkCode"</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">"String"</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">"com.star.entity.UserMail"</span>&gt;</span>
    select * from myblog.t_usermail where code = #&#123;code&#125;
  <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>

    <span class="hljs-comment">&lt;!--激活账户，修改用户状态--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">update</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"updateUserStatus"</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">"com.star.entity.UserMail"</span>&gt;</span>
    update myblog.t_usermail set status=1,code=null where id=#&#123;id&#125;
  <span class="hljs-tag">&lt;/<span class="hljs-name">update</span>&gt;</span>

    <span class="hljs-comment">&lt;!--登录,根据 status=1 进行查询--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"loginUserMail"</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">"com.star.entity.UserMail"</span> &gt;</span>
    select * from myblog.t_usermail where username=#&#123;username&#125; and password=#&#123;password&#125; and status=1
  <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span></code></pre>



<h3 id="LoginController文件修改"><a href="#LoginController文件修改" class="headerlink" title="LoginController文件修改"></a>LoginController文件修改</h3><p><strong>需要在以前判断 <code>t_user</code>表的基础上，再判断 <code>t_usermail</code>，取两个表符合条件的并集</strong></p>
<p>添加以下代码</p>
<pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@Description</span>: 登录校验</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@Param</span>: username:用户名</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@Param</span>: password:密码</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@Param</span>: session:session域</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@Param</span>: attributes:返回页面消息</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@Return</span>: 登录成功跳转登录成功页面，登录失败返回登录页面</span>
<span class="hljs-comment"> */</span>
<span class="hljs-meta">@PostMapping</span>(<span class="hljs-string">"/login"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">login</span><span class="hljs-params">(@RequestParam String username,</span></span>
<span class="hljs-function"><span class="hljs-params">                    @RequestParam String password,</span></span>
<span class="hljs-function"><span class="hljs-params">                    HttpSession session,</span></span>
<span class="hljs-function"><span class="hljs-params">                    RedirectAttributes attributes)</span></span>&#123;
    <span class="hljs-comment">//System.out.println("------------username"+username);</span>
    <span class="hljs-comment">//System.out.println("------------password"+password);</span>

    User user = userService.checkUser(username,password);
    UserMail userMail = userService.checkUserMail(username,password);
    UserMail RealUserMail = userMailService.loginUserMail(userMail);
    <span class="hljs-keyword">if</span>(user!=<span class="hljs-keyword">null</span>)&#123;
        session.setAttribute(<span class="hljs-string">"user"</span>,user);
        <span class="hljs-keyword">return</span> <span class="hljs-string">"admin/index"</span>;
    &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(RealUserMail!=<span class="hljs-keyword">null</span>)&#123;
        session.setAttribute(<span class="hljs-string">"user"</span>,<span class="hljs-keyword">new</span> User());
        <span class="hljs-keyword">return</span> <span class="hljs-string">"admin/index"</span>;
    &#125;<span class="hljs-keyword">else</span>&#123;
        attributes.addFlashAttribute(<span class="hljs-string">"message"</span>,<span class="hljs-string">"用户名或密码错误"</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-string">"redirect:/admin"</span>;
    &#125;</code></pre>



<h3 id="邮箱用户登陆Controller"><a href="#邮箱用户登陆Controller" class="headerlink" title="邮箱用户登陆Controller"></a>邮箱用户登陆Controller</h3><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.star.controller;

<span class="hljs-keyword">import</span> com.star.entity.UserMail;
<span class="hljs-keyword">import</span> com.star.service.UserMailService;
<span class="hljs-keyword">import</span> com.star.util.MD5Utils;
<span class="hljs-keyword">import</span> com.star.util.UUIDUtils;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Controller;
<span class="hljs-keyword">import</span> org.springframework.ui.Model;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;

<span class="hljs-meta">@Controller</span>
<span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">"/mail"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserMailController</span> </span>&#123;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> UserMailService userMailService;


    <span class="hljs-meta">@RequestMapping</span>(value = <span class="hljs-string">"/returnIndex"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">index</span><span class="hljs-params">()</span></span>&#123;
        <span class="hljs-keyword">return</span> <span class="hljs-string">"test/index"</span>;
    &#125;

    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * 注册</span>
<span class="hljs-comment">     */</span>
    <span class="hljs-meta">@RequestMapping</span>(value = <span class="hljs-string">"/registerUserMail"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">registerMail</span><span class="hljs-params">(UserMail userMail)</span></span>&#123;
        String password = userMail.getPassword();
        String RealPassword = MD5Utils.code(password);
        userMail.setPassword(RealPassword);
        userMail.setStatus(<span class="hljs-number">0</span>);
        String code = UUIDUtils.getUUID() + UUIDUtils.getUUID();
        userMail.setCode(code);
        userMailService.register(userMail);
        <span class="hljs-keyword">return</span> <span class="hljs-string">"test/success"</span>;
    &#125;

    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * 检验邮箱中的code激活账户</span>
<span class="hljs-comment">     */</span>
    <span class="hljs-meta">@RequestMapping</span>(value = <span class="hljs-string">"/checkCode"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">checkCode</span><span class="hljs-params">(String code)</span></span>&#123;
        UserMail userMail = userMailService.checkCode(code);
        <span class="hljs-comment">//System.out.println(userMail);</span>
        <span class="hljs-keyword">if</span>(userMail != <span class="hljs-keyword">null</span>)&#123;
            userMail.setStatus(<span class="hljs-number">1</span>);
            userMail.setCode(<span class="hljs-string">""</span>);
            userMailService.updateUserStatus(userMail);
        &#125;
        <span class="hljs-keyword">return</span> <span class="hljs-string">"admin/login"</span>;
    &#125;

    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * 跳转到登陆页面</span>
<span class="hljs-comment">     */</span>
    <span class="hljs-meta">@RequestMapping</span>(value = <span class="hljs-string">"/loginPage"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">MailLoginPage</span><span class="hljs-params">()</span></span>&#123;
        <span class="hljs-keyword">return</span> <span class="hljs-string">"admin/login"</span>;
    &#125;


&#125;</code></pre>



<h3 id="前端页面"><a href="#前端页面" class="headerlink" title="前端页面"></a>前端页面</h3><ul>
<li><p>index.html</p>
</li>
<li><pre><code class="html"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span>
<span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span> <span class="attr">xmlns:th</span>=<span class="string">"http://www.w3.org/1999/xhtml"</span>&gt;</span>
<span class="tag">&lt;<span class="name">head</span>&gt;</span>
    <span class="tag">&lt;<span class="name">link</span> <span class="attr">th:href</span>=<span class="string">"@{/layui/css/layui.css}"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> /&gt;</span>
    <span class="comment">&lt;!-- 你的HTML代码  th:action="@{/admin/register}" th:object="${user}" method="post"--&gt;</span>
    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span>
    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="tag">&lt;<span class="name">title</span>&gt;</span>博客管理邮箱注册<span class="tag">&lt;/<span class="name">title</span>&gt;</span>
    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"../static/images/favicon.ico"</span> <span class="attr">th:href</span>=<span class="string">"@{/images/me.jpg}"</span> <span class="attr">rel</span>=<span class="string">"icon"</span> <span class="attr">type</span>=<span class="string">"image/x-ico"</span>&gt;</span>
    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"https://cdn.jsdelivr.net/semantic-ui/2.2.4/semantic.min.css"</span>&gt;</span>
    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"../../static/css/me.css"</span> <span class="attr">th:href</span>=<span class="string">"@{/css/me.css}"</span>&gt;</span>
    <span class="tag">&lt;<span class="name">link</span> <span class="attr">th:href</span>=<span class="string">"@{/layui/css/layui.css}"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> /&gt;</span>
<span class="tag">&lt;/<span class="name">head</span>&gt;</span>
<span class="tag">&lt;<span class="name">body</span>&gt;</span>
<span class="comment">&lt;!--&lt;form action="/mail/registerUserMail" method="post"&gt;--&gt;</span>
<span class="comment">&lt;!--    用户名：&lt;input type="text" id="username" name="username"/&gt;&lt;br&gt;--&gt;</span>
<span class="comment">&lt;!--    密码：&lt;input type="password" id="password" name="password"/&gt;&lt;br&gt;--&gt;</span>
<span class="comment">&lt;!--    邮箱：&lt;input type="email" id="email" name="useremail"&gt;&lt;br&gt;--&gt;</span>
<span class="comment">&lt;!--    &lt;input type="submit" value="注册"&gt;--&gt;</span>
<span class="comment">&lt;!--&lt;/form&gt;--&gt;</span>
<span class="comment">&lt;!--&lt;a href="/templates/test/login.html"&gt;登录&lt;/a&gt;--&gt;</span>
<span class="tag">&lt;<span class="name">br</span>&gt;</span>
<span class="tag">&lt;<span class="name">br</span>&gt;</span>
<span class="tag">&lt;<span class="name">br</span>&gt;</span>
<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"m-container-small m-padded-tb-massive"</span> <span class="attr">style</span>=<span class="string">"max-width: 30em !important;"</span>&gt;</span>
    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"ur container"</span>&gt;</span>
        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"ui middle aligned center aligned grid"</span>&gt;</span>
            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"column"</span>&gt;</span>
                <span class="tag">&lt;<span class="name">h2</span> <span class="attr">class</span>=<span class="string">"ui teal image header"</span>&gt;</span>
                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"content"</span>&gt;</span>
                        管理后台邮箱注册
                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span>
                <span class="tag">&lt;/<span class="name">h2</span>&gt;</span>

                <span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">"layui-form"</span> <span class="attr">action</span>=<span class="string">"/mail/registerUserMail"</span> <span class="attr">method</span>=<span class="string">"post"</span> &gt;</span>
                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"layui-form-item"</span>&gt;</span>
                        <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"layui-form-label"</span>&gt;</span>用户名<span class="tag">&lt;/<span class="name">label</span>&gt;</span>
                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"layui-input-block"</span>&gt;</span>
                            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">required</span>  <span class="attr">lay-verify</span>=<span class="string">"required"</span> <span class="attr">placeholder</span>=<span class="string">"请输入用户名"</span> <span class="attr">autocomplete</span>=<span class="string">"off"</span> <span class="attr">class</span>=<span class="string">"layui-input"</span>&gt;</span>
                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span>
                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span>
                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"layui-form-item"</span>&gt;</span>
                        <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"layui-form-label"</span>&gt;</span>密码<span class="tag">&lt;/<span class="name">label</span>&gt;</span>
                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"layui-input-block"</span>&gt;</span>
                            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">required</span> <span class="attr">lay-verify</span>=<span class="string">"required"</span> <span class="attr">placeholder</span>=<span class="string">"请输入密码"</span> <span class="attr">autocomplete</span>=<span class="string">"off"</span> <span class="attr">class</span>=<span class="string">"layui-input"</span>&gt;</span>
                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span>
                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span>
                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"layui-form-item"</span>&gt;</span>
                        <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"layui-form-label"</span>&gt;</span>邮箱<span class="tag">&lt;/<span class="name">label</span>&gt;</span>
                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"layui-input-block"</span>&gt;</span>
                            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"email"</span> <span class="attr">name</span>=<span class="string">"useremail"</span> <span class="attr">required</span>  <span class="attr">lay-verify</span>=<span class="string">"required"</span> <span class="attr">placeholder</span>=<span class="string">"请输入邮箱"</span> <span class="attr">autocomplete</span>=<span class="string">"off"</span> <span class="attr">class</span>=<span class="string">"layui-input"</span>&gt;</span>
                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span>
                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span>
                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"layui-form-item"</span>&gt;</span>
                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"layui-input-block"</span>&gt;</span>
                            <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"layui-btn"</span> <span class="attr">lay-submit</span> <span class="attr">lay-filter</span>=<span class="string">"formDemo"</span>&gt;</span>立即提交<span class="tag">&lt;/<span class="name">button</span>&gt;</span>
                            <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"reset"</span> <span class="attr">class</span>=<span class="string">"layui-btn layui-btn-primary"</span>&gt;</span>重置<span class="tag">&lt;/<span class="name">button</span>&gt;</span>
                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span>
                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span>

</code></pre>
</li>
</ul>
<pre><code>            &lt;/form&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;</code></pre>  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2/dist/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/semantic-ui/2.2.4/semantic.min.js"></script>
  <script th:src="@{/layui/layui.js}"></script>
  <script>
      //Demo
      layui.use('form', function(){
          var form = layui.form;
          console.log(form);
          //监听提交
          form.on('submit(formDemo)', function(data){
              var message =  JSON.stringify(data.field);
              var $;
              $.ajax({
                  url:"/mail/registerUserMail",
                  async: false,
                  type:"POST",
                  contentType: "application/json",
                  data: message,
                  // success: function(data){
                  //     console.log(123);
                  // }
              })
              return false;
          });
      });
  </script>
  
  
  <pre><code class="hljs xml">
```html
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span> <span class="hljs-attr">xmlns:th</span>=<span class="hljs-string">"http://www.w3.org/1999/xhtml"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>注册成功，请激活账户<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"../static/images/favicon.ico"</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">"@&#123;/images/me.jpg&#125;"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"icon"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"image/x-ico"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://cdn.jsdelivr.net/semantic-ui/2.2.4/semantic.min.css"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"../static/css/me.css"</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">"@&#123;/css/me.css&#125;"</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>




<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"m-container-small m-padded-tb-massive"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ui error message m-padded-tb-huge"</span> &gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ui contianer"</span>&gt;</span>

            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>已经发送邮件到您的邮箱，请点击邮件中的链接进行激活<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"m-margin-top-max"</span> <span class="hljs-attr">align</span>=<span class="hljs-string">"center"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">"@&#123;/&#125;"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ui teal button m-mobile-wide"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"home icon"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>返回首页<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span>


<span class="hljs-comment">&lt;!--底部栏--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">footer</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"waypoint"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ui inverted vertical segment m-padded-tb-massive m-opacity"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ui center aligned container"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ui inverted divided stackable grid"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"three wide column"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ui inverted link list"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"item"</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"../static/images/oneStarWechat.jpg"</span> <span class="hljs-attr">th:src</span>=<span class="hljs-string">"@&#123;/images/oneStarWechat.jpg&#125;"</span>  <span class="hljs-attr">class</span>=<span class="hljs-string">"ui rounded image"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">""</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"width: 110px"</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"four wide column"</span> &gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">h4</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ui inverted header m-text-thin m-text-spaced "</span> &gt;</span>最新博客<span class="hljs-tag">&lt;/<span class="hljs-name">h4</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"newblog-container"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ui inverted link list"</span> <span class="hljs-attr">th:fragment</span>=<span class="hljs-string">"newblogList"</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">th:href</span>=<span class="hljs-string">"@&#123;/blog/&#123;id&#125;(id=$&#123;blog.id&#125;)&#125;"</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"_blank"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"item m-text-thin"</span> <span class="hljs-attr">th:each</span>=<span class="hljs-string">"blog : $&#123;newblogs&#125;"</span> <span class="hljs-attr">th:text</span>=<span class="hljs-string">"$&#123;blog.title&#125;"</span>&gt;</span>最新博文<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"four wide column"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">h4</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ui inverted header m-text-thin m-text-spaced "</span>&gt;</span>联系我<span class="hljs-tag">&lt;/<span class="hljs-name">h4</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ui inverted link list"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"item m-text-thin"</span>&gt;</span>Email：7142220@qq.com<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"item m-text-thin"</span>&gt;</span>QQ：7142220<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"five wide column"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">h4</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"inverted header m-text-thin m-text-spaced"</span>&gt;</span>我的客栈已经营<span class="hljs-tag">&lt;/<span class="hljs-name">h4</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"htmer_time"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"item m-text-thin"</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">footer</span>&gt;</span>


<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.jsdelivr.net/npm/jquery@3.2/dist/jquery.min.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.jsdelivr.net/semantic-ui/2.2.4/semantic.min.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span>
<span class="javascript">    $(<span class="hljs-string">'#newblog-container'</span>).load(<span class="hljs-comment">/*[[@&#123;/footer/newblog&#125;]]*/</span><span class="hljs-string">"/footer/newblog"</span>);</span>

<span class="actionscript">    <span class="hljs-comment">// 运行时间统计</span></span>
<span class="actionscript">    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">secondToDate</span><span class="hljs-params">(second)</span> </span>&#123;</span>
        if (!second) &#123;
<span class="actionscript">            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</span>
        &#125;
<span class="javascript">        <span class="hljs-keyword">var</span> time = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);</span>
        if (second &gt;= 365 * 24 * 3600) &#123;
<span class="javascript">            time[<span class="hljs-number">0</span>] = <span class="hljs-built_in">parseInt</span>(second / (<span class="hljs-number">365</span> * <span class="hljs-number">24</span> * <span class="hljs-number">3600</span>));</span>
            second %= 365 * 24 * 3600;
        &#125;
        if (second &gt;= 24 * 3600) &#123;
<span class="javascript">            time[<span class="hljs-number">1</span>] = <span class="hljs-built_in">parseInt</span>(second / (<span class="hljs-number">24</span> * <span class="hljs-number">3600</span>));</span>
            second %= 24 * 3600;
        &#125;
        if (second &gt;= 3600) &#123;
<span class="javascript">            time[<span class="hljs-number">2</span>] = <span class="hljs-built_in">parseInt</span>(second / <span class="hljs-number">3600</span>);</span>
            second %= 3600;
        &#125;
        if (second &gt;= 60) &#123;
<span class="javascript">            time[<span class="hljs-number">3</span>] = <span class="hljs-built_in">parseInt</span>(second / <span class="hljs-number">60</span>);</span>
            second %= 60;
        &#125;
        if (second &gt; 0) &#123;
            time[4] = second;
        &#125;
<span class="actionscript">        <span class="hljs-keyword">return</span> time;</span>
    &#125;
<span class="actionscript">    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setTime</span><span class="hljs-params">()</span> </span>&#123;</span>
<span class="actionscript">        <span class="hljs-comment">/*此处为网站的创建时间*/</span></span>
<span class="javascript">        <span class="hljs-keyword">var</span> create_time = <span class="hljs-built_in">Math</span>.round(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-built_in">Date</span>.UTC(<span class="hljs-number">2020</span>, <span class="hljs-number">01</span>, <span class="hljs-number">25</span>, <span class="hljs-number">15</span>, <span class="hljs-number">15</span>, <span class="hljs-number">15</span>)).getTime() / <span class="hljs-number">1000</span>);</span>
<span class="javascript">        <span class="hljs-keyword">var</span> timestamp = <span class="hljs-built_in">Math</span>.round((<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getTime() + <span class="hljs-number">8</span> * <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>) / <span class="hljs-number">1000</span>);</span>
        currentTime = secondToDate((timestamp - create_time));
<span class="actionscript">        currentTimeHtml = currentTime[<span class="hljs-number">0</span>] + <span class="hljs-string">'年'</span> + currentTime[<span class="hljs-number">1</span>] + <span class="hljs-string">'天'</span></span>
<span class="actionscript">            + currentTime[<span class="hljs-number">2</span>] + <span class="hljs-string">'时'</span> + currentTime[<span class="hljs-number">3</span>] + <span class="hljs-string">'分'</span> + currentTime[<span class="hljs-number">4</span>]</span>
<span class="actionscript">            + <span class="hljs-string">'秒'</span>;</span>
<span class="javascript">        <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"htmer_time"</span>).innerHTML = currentTimeHtml;</span>
    &#125;
    setInterval(setTime, 1000);
<span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre>



<ul>
<li>上面是welcome.html</li>
</ul>
<h2 id="15-手机验证码登陆"><a href="#15-手机验证码登陆" class="headerlink" title="15. 手机验证码登陆"></a>15. 手机验证码登陆</h2><h3 id="功能分析：-5"><a href="#功能分析：-5" class="headerlink" title="功能分析："></a>功能分析：</h3><ul>
<li>使用手机验证码登陆，直接跳转到管理界面，但是不存储到数据库，只能维持这一次的登陆</li>
<li>考虑到验证码的过期，可以使用redis来存储 <code>手机号码-验证码</code>的键值对</li>
<li>使用阿里云的功能来开通短信的收发</li>
</ul>
<h3 id="功能技术栈："><a href="#功能技术栈：" class="headerlink" title="功能技术栈："></a>功能技术栈：</h3><ul>
<li>Redis</li>
<li>阿里云</li>
</ul>
<h3 id="首先测试短信的正常收发，使用PostMan"><a href="#首先测试短信的正常收发，使用PostMan" class="headerlink" title="首先测试短信的正常收发，使用PostMan"></a>首先测试短信的正常收发，使用PostMan</h3><ul>
<li>短信收发，根据阿里云官方API改编</li>
</ul>
<pre><code class="hljs java"><span class="hljs-keyword">package</span> com.star.util;
<span class="hljs-keyword">import</span> com.alibaba.fastjson.JSONObject;
<span class="hljs-keyword">import</span> com.aliyuncs.CommonRequest;
<span class="hljs-keyword">import</span> com.aliyuncs.CommonResponse;
<span class="hljs-keyword">import</span> com.aliyuncs.DefaultAcsClient;
<span class="hljs-keyword">import</span> com.aliyuncs.IAcsClient;
<span class="hljs-keyword">import</span> com.aliyuncs.exceptions.ClientException;
<span class="hljs-keyword">import</span> com.aliyuncs.exceptions.ServerException;
<span class="hljs-keyword">import</span> com.aliyuncs.http.MethodType;
<span class="hljs-keyword">import</span> com.aliyuncs.profile.DefaultProfile;
<span class="hljs-keyword">import</span> com.star.service.RedisService;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Value;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;

<span class="hljs-keyword">import</span> java.util.Random;

<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SendNoteUtil</span> </span>&#123;
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> RedisService redisService;
    <span class="hljs-meta">@Value</span>(<span class="hljs-string">"$&#123;redis.key.prefix.authCode&#125;"</span>)
    <span class="hljs-keyword">private</span> String REDIS_KEY_PREFIX_AUTH_CODE;
    <span class="hljs-meta">@Value</span>(<span class="hljs-string">"$&#123;redis.key.expire.authCode&#125;"</span>)
    <span class="hljs-keyword">private</span> Long AUTH_CODE_EXPIRE_SECONDS;

    <span class="hljs-comment">//验证平台信息 开发者无需任何更改</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String dysmsapi = <span class="hljs-string">"dysmsapi.aliyuncs.com"</span>;

    DefaultProfile profile = DefaultProfile.getProfile(<span class="hljs-string">"cn-hangzhou"</span>, <span class="hljs-string">"*******************"</span>, <span class="hljs-string">"**************************"</span>);
    IAcsClient client = <span class="hljs-keyword">new</span> DefaultAcsClient(profile);
    <span class="hljs-comment">//这一步的两个参数,一个是要发送验证码的手机号 一个是模板Code用来区分登录注册</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">sendNoteMessgae</span><span class="hljs-params">(String PhoneNumbers)</span></span>&#123;
        StringBuilder sb = <span class="hljs-keyword">new</span> StringBuilder();
        Random random = <span class="hljs-keyword">new</span> Random();
        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">6</span>;i++)&#123;
            <span class="hljs-keyword">int</span> x = random.nextInt(<span class="hljs-number">10</span>);
            <span class="hljs-keyword">if</span>(x == <span class="hljs-number">0</span>)&#123;
                i--;
                <span class="hljs-keyword">continue</span>;
            &#125;
            sb.append(x);
        &#125;
        CommonRequest request = <span class="hljs-keyword">new</span> CommonRequest();
        <span class="hljs-comment">//request.setSysProtocol(ProtocolType.HTTPS);</span>
        request.setSysMethod(MethodType.POST);
        request.putQueryParameter(<span class="hljs-string">"RegionId"</span>, <span class="hljs-string">"cn-hangzhou"</span>);
        request.setSysDomain(dysmsapi);
        request.setSysVersion(<span class="hljs-string">"2017-05-25"</span>);
        request.setSysAction(<span class="hljs-string">"SendSms"</span>);
        request.putQueryParameter(<span class="hljs-string">"PhoneNumbers"</span>, PhoneNumbers);<span class="hljs-comment">//接受验证码的手机号</span>
        request.putQueryParameter(<span class="hljs-string">"SignName"</span>, <span class="hljs-string">"Halo博客"</span>);<span class="hljs-comment">//签名</span>

        <span class="hljs-comment">//模板代码,我暂时用的参数,你可以直接写成模板码,模板码参考第八步</span>
        request.putQueryParameter(<span class="hljs-string">"TemplateCode"</span>, <span class="hljs-string">"SMS_205811339"</span>);

        <span class="hljs-comment">//用户定义的验证码内容</span>
        request.putQueryParameter(<span class="hljs-string">"TemplateParam"</span>,<span class="hljs-string">"&#123;code:"</span>+sb.toString()+<span class="hljs-string">"&#125;"</span>);


        <span class="hljs-comment">//验证码绑定手机号并存储到redis</span>
        redisService.set(REDIS_KEY_PREFIX_AUTH_CODE + PhoneNumbers, sb.toString());
        redisService.expire(REDIS_KEY_PREFIX_AUTH_CODE + PhoneNumbers,AUTH_CODE_EXPIRE_SECONDS);
        <span class="hljs-keyword">try</span> &#123;
            CommonResponse response = client.getCommonResponse(request);
            String returnStr = response.getData();
            System.out.println(returnStr);
            JSONObject jsonObject = JSONObject.parseObject(returnStr);
            <span class="hljs-comment">//返回的信息</span>
            <span class="hljs-keyword">return</span> jsonObject.getString(<span class="hljs-string">"Message"</span>);
        &#125; <span class="hljs-keyword">catch</span> (ServerException e) &#123;
            <span class="hljs-keyword">return</span> e.getErrMsg();
        &#125; <span class="hljs-keyword">catch</span> (ClientException e) &#123;
            <span class="hljs-keyword">return</span> e.getErrMsg();
        &#125;
    &#125;;

&#125;</code></pre>



<h3 id="Redis和Mail的yml配置文件"><a href="#Redis和Mail的yml配置文件" class="headerlink" title="Redis和Mail的yml配置文件"></a>Redis和Mail的yml配置文件</h3><pre><code class="hljs yml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">thymeleaf:</span>
    <span class="hljs-attr">mode:</span> <span class="hljs-string">HTML</span>
  <span class="hljs-attr">profiles:</span>
    <span class="hljs-attr">active:</span> <span class="hljs-string">pro</span>
  <span class="hljs-attr">messages:</span>
    <span class="hljs-attr">basename:</span> <span class="hljs-string">i18n/messages</span>
  <span class="hljs-attr">redis:</span>
    <span class="hljs-attr">host:</span> <span class="hljs-string">localhost</span>
    <span class="hljs-attr">database:</span> <span class="hljs-number">0</span>
    <span class="hljs-attr">port:</span> <span class="hljs-number">6379</span>
    <span class="hljs-attr">password:</span>
    <span class="hljs-attr">jedis:</span>
      <span class="hljs-attr">pool:</span>
        <span class="hljs-attr">max-active:</span> <span class="hljs-number">8</span>
        <span class="hljs-attr">max-wait:</span> <span class="hljs-string">-1ms</span>
        <span class="hljs-attr">max-idle:</span> <span class="hljs-number">8</span>
        <span class="hljs-attr">min-idle:</span> <span class="hljs-number">0</span>
    <span class="hljs-attr">timeout:</span> <span class="hljs-string">3000ms</span>
  <span class="hljs-attr">mail:</span>
    <span class="hljs-attr">host:</span> <span class="hljs-string">smtp.qq.com</span> <span class="hljs-comment">#发送邮件服务器</span>
    <span class="hljs-attr">username:</span> <span class="hljs-number">7142220</span><span class="hljs-string">@qq.com</span> <span class="hljs-comment">#发送邮件的邮箱地址</span>
    <span class="hljs-attr">password:</span>  <span class="hljs-string">atnrxkbmzzmnbijg</span> <span class="hljs-comment">#客户端授权码，不是邮箱密码，这个在qq邮箱设置里面自动生成的</span>
    <span class="hljs-attr">properties.mail.smtp.port:</span> <span class="hljs-number">465</span> <span class="hljs-comment">#端口号465或587</span>
    <span class="hljs-attr">from:</span> <span class="hljs-number">7142220</span><span class="hljs-string">@qq.com</span> <span class="hljs-comment"># 发送邮件的地址，和上面username一致</span>
    <span class="hljs-attr">properties.mail.smtp.starttls.enable:</span> <span class="hljs-literal">true</span>
    <span class="hljs-attr">properties.mail.smtp.starttls.required:</span> <span class="hljs-literal">true</span>
    <span class="hljs-attr">properties.mail.smtp.ssl.enable:</span> <span class="hljs-literal">true</span>
    <span class="hljs-attr">default-encoding:</span> <span class="hljs-string">utf-8</span>

<span class="hljs-attr">comment.avatar:</span> <span class="hljs-string">/images/avatar.png</span>
<span class="hljs-attr">message.avatar:</span> <span class="hljs-string">/images/avatar.png</span>

<span class="hljs-comment">#自定义redis key</span>
<span class="hljs-attr">redis:</span>
  <span class="hljs-attr">key:</span>
    <span class="hljs-attr">prefix:</span>
      <span class="hljs-attr">authCode:</span> <span class="hljs-string">protal:authCode</span>
    <span class="hljs-attr">expire:</span>
      <span class="hljs-attr">authCode:</span> <span class="hljs-number">300</span></code></pre>



<h3 id="Redis业务层，工具类集成"><a href="#Redis业务层，工具类集成" class="headerlink" title="Redis业务层，工具类集成"></a>Redis业务层，工具类集成</h3><p><strong>整合RedisTemplate</strong></p>
<pre><code class="hljs java"><span class="hljs-keyword">package</span> com.star.service;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">RedisService</span> </span>&#123;
    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * 存储数据</span>
<span class="hljs-comment">     */</span>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">set</span><span class="hljs-params">(String key, String value)</span></span>;

    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * 获取数据</span>
<span class="hljs-comment">     */</span>
    <span class="hljs-function">String <span class="hljs-title">get</span><span class="hljs-params">(String key)</span></span>;

    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * 设置超期时间</span>
<span class="hljs-comment">     */</span>
    <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">expire</span><span class="hljs-params">(String key, <span class="hljs-keyword">long</span> expire)</span></span>;

    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * 删除数据</span>
<span class="hljs-comment">     */</span>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">remove</span><span class="hljs-params">(String key)</span></span>;

    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * 自增操作</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> delta 自增步长</span>
<span class="hljs-comment">     */</span>
    <span class="hljs-function">Long <span class="hljs-title">increment</span><span class="hljs-params">(String key, <span class="hljs-keyword">long</span> delta)</span></span>;

&#125;</code></pre>

<pre><code class="hljs java"><span class="hljs-keyword">package</span> com.star.service.impl;

<span class="hljs-keyword">import</span> com.star.service.RedisService;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.data.redis.core.StringRedisTemplate;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;

<span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RedisServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">RedisService</span> </span>&#123;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> StringRedisTemplate stringRedisTemplate;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">set</span><span class="hljs-params">(String key, String value)</span> </span>&#123;
        stringRedisTemplate.opsForValue().set(key,value);
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">get</span><span class="hljs-params">(String key)</span> </span>&#123;
        <span class="hljs-keyword">return</span> stringRedisTemplate.opsForValue().get(key);
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">expire</span><span class="hljs-params">(String key, <span class="hljs-keyword">long</span> expire)</span> </span>&#123;
        <span class="hljs-keyword">return</span> stringRedisTemplate.expire(key,expire, TimeUnit.SECONDS);
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">remove</span><span class="hljs-params">(String key)</span> </span>&#123;
        stringRedisTemplate.delete(key);
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Long <span class="hljs-title">increment</span><span class="hljs-params">(String key, <span class="hljs-keyword">long</span> delta)</span> </span>&#123;
        <span class="hljs-keyword">return</span> stringRedisTemplate.opsForValue().increment(key,delta);
    &#125;
&#125;</code></pre>



<h3 id="在LoginController中添加代码"><a href="#在LoginController中添加代码" class="headerlink" title="在LoginController中添加代码"></a>在LoginController中添加代码</h3><pre><code class="hljs java"><span class="hljs-meta">@Autowired</span>
<span class="hljs-keyword">private</span> SendNoteUtil sendNoteUtil;

<span class="hljs-meta">@Autowired</span>
<span class="hljs-keyword">private</span> RedisService redisService;

<span class="hljs-meta">@Value</span>(<span class="hljs-string">"$&#123;redis.key.prefix.authCode&#125;"</span>)
<span class="hljs-keyword">private</span> String REDIS_KEY_PREFIX_AUTH_CODE;

<span class="hljs-comment">/**</span>
<span class="hljs-comment"> * 跳转界面</span>
<span class="hljs-comment"> */</span>
<span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/api/note"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">loginPage1</span><span class="hljs-params">()</span></span>&#123;
    <span class="hljs-keyword">return</span> <span class="hljs-string">"redis/login"</span>;
&#125;

<span class="hljs-comment">/**</span>
<span class="hljs-comment"> * 获取验证码</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@param</span> phone</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@param</span> response</span>
<span class="hljs-comment"> */</span>
<span class="hljs-meta">@RequestMapping</span>(value = <span class="hljs-string">"/api/note/sendNote/&#123;phone&#125;"</span>,method = RequestMethod.GET)
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sendNote</span><span class="hljs-params">(@PathVariable(<span class="hljs-string">"phone"</span>)</span> String phone, HttpServletResponse response)</span>&#123;
    System.out.println(phone);
    <span class="hljs-keyword">try</span> &#123;
        response.getWriter().write(sendNoteUtil.sendNoteMessgae(phone));
    &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;
        e.printStackTrace();
    &#125;
&#125;

<span class="hljs-comment">/**</span>
<span class="hljs-comment"> *</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@param</span> phone</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@param</span> authCode</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment"> */</span>

<span class="hljs-meta">@RequestMapping</span>(value = <span class="hljs-string">"/api/note/login/&#123;phone&#125;/&#123;authCode&#125;"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">login</span><span class="hljs-params">(@PathVariable(<span class="hljs-string">"phone"</span>)</span> String phone, @<span class="hljs-title">PathVariable</span><span class="hljs-params">(<span class="hljs-string">"authCode"</span>)</span> String authCode)</span>&#123;
    System.out.println(<span class="hljs-string">"phonenumber--------------"</span>+phone);
    MyX.phone1 = phone;
    MyX.authCode1 = authCode;
    <span class="hljs-comment">//验证验证码</span>
    <span class="hljs-keyword">if</span>(!verifyAuthCode(authCode,phone))&#123;
        <span class="hljs-comment">//System.out.println("1222222222222222");</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">"redirect:/admin"</span>;
    &#125;
    <span class="hljs-comment">//System.out.println("123465789");</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">"admin/index"</span>;
&#125;

<span class="hljs-comment">/**</span>
<span class="hljs-comment"> * 对输入的验证码进行校验</span>
<span class="hljs-comment"> * 和Redis中的键值对进行比对即可</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@param</span> authCode</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@param</span> telephone</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment"> */</span>
<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">verifyAuthCode</span><span class="hljs-params">(String authCode, String telephone)</span></span>&#123;
    <span class="hljs-keyword">if</span>(StringUtils.isEmpty(authCode))&#123;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
    &#125;
    String realAuthCode = redisService.get(REDIS_KEY_PREFIX_AUTH_CODE + telephone);
    <span class="hljs-comment">//System.out.println("real-------------"+realAuthCode);</span>
    <span class="hljs-keyword">return</span> authCode.equals(realAuthCode);
&#125;</code></pre>

<ul>
<li>可以在后端进行测试正常的短信发送，登陆服务，这里给出的是集成前端的完整代码 </li>
</ul>
<h3 id="前端集成"><a href="#前端集成" class="headerlink" title="前端集成"></a>前端集成</h3><ul>
<li><p>前端这里遇到了很多坑，首先，ajax异步请求在传递前端参数的时候，后端Controller层代码可以正常运行，但是无法跳转到指定的界面</p>
</li>
<li><p>前端后端全都不报错，原因是因为ajax只是局部刷新，所以不能在后台接口进行页面的跳转</p>
</li>
<li><p>所以我们只能在前端进行跳转  <code>window.location.href=&quot;http://localhost:8080/admin/blogs&quot;;</code></p>
</li>
<li><p>但是在本项目中，有拦截权限验证，我们无法通过前端直接跳转到管理界面，会显示没有权限</p>
</li>
<li><p>那么我们该如何做？在这里博主给出一种方法</p>
<ul>
<li><p>定义一个全局类Myx，这里有公共变量供所有类使用</p>
</li>
<li><p>在后端接收到前端的参数，在redis中完成验证，发现参数都对应正确后，直接把对应的值赋给Myx中的变量</p>
</li>
<li><p>对拦截器类中判断的条件做出更改，本来判断条件为用户为空，现在改成用户为空并且两个参数都为空(如果不为空说明通过了Redis的验证)</p>
</li>
<li><pre><code class="java"><span class="keyword">package</span> com.star.util;

<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyX</span> </span>{
    <span class="keyword">public</span> <span class="keyword">static</span> String phone1;
    <span class="keyword">public</span> <span class="keyword">static</span> String authCode1;

    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getPhone1</span><span class="params">()</span> </span>{
        <span class="keyword">return</span> phone1;
    }

    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setPhone1</span><span class="params">(String phone1)</span> </span>{
        MyX.phone1 = phone1;
    }

    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getAuthCode1</span><span class="params">()</span> </span>{
        <span class="keyword">return</span> authCode1;
    }

    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setAuthCode1</span><span class="params">(String authCode1)</span> </span>{
        MyX.authCode1 = authCode1;
    }
}
&lt;!--￼<span class="number">93</span>--&gt;</code></pre>
</li>
<li><p>这样就跳转到了后端管理</p>
</li>
</ul>
</li>
<li><p>前端代码：</p>
</li>
<li><pre><code class="html"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span>
<span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span> <span class="attr">xmlns:th</span>=<span class="string">"http://www.w3.org/1999/xhtml"</span>&gt;</span>
<span class="tag">&lt;<span class="name">head</span>&gt;</span>
    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span>
    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="tag">&lt;<span class="name">title</span>&gt;</span>手机号登录<span class="tag">&lt;/<span class="name">title</span>&gt;</span>
    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"../static/images/favicon.ico"</span> <span class="attr">th:href</span>=<span class="string">"@{/images/me.jpg}"</span> <span class="attr">rel</span>=<span class="string">"icon"</span> <span class="attr">type</span>=<span class="string">"image/x-ico"</span>&gt;</span>
    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"https://cdn.jsdelivr.net/semantic-ui/2.2.4/semantic.min.css"</span>&gt;</span>
    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"../../static/css/me.css"</span> <span class="attr">th:href</span>=<span class="string">"@{/css/me.css}"</span>&gt;</span>
    <span class="tag">&lt;<span class="name">link</span> <span class="attr">th:href</span>=<span class="string">"@{/layui/css/layui.css}"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> /&gt;</span>
<span class="tag">&lt;/<span class="name">head</span>&gt;</span>
<span class="tag">&lt;<span class="name">body</span>&gt;</span>

<span class="tag">&lt;<span class="name">br</span>&gt;</span>
<span class="tag">&lt;<span class="name">br</span>&gt;</span>
<span class="tag">&lt;<span class="name">br</span>&gt;</span>
<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"m-container-small m-padded-tb-massive"</span> <span class="attr">style</span>=<span class="string">"max-width: 30em !important;"</span>&gt;</span>
    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"ur container"</span>&gt;</span>
        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"ui middle aligned center aligned grid"</span>&gt;</span>
            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"column"</span>&gt;</span>
                <span class="tag">&lt;<span class="name">h2</span> <span class="attr">class</span>=<span class="string">"ui teal image header"</span>&gt;</span>
                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"content"</span>&gt;</span>
                        管理后台手机验证码登录
                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span>
                <span class="tag">&lt;/<span class="name">h2</span>&gt;</span>
                <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">"layui-input"</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"phone"</span> <span class="attr">placeholder</span>=<span class="string">"请输入手机号"</span>&gt;</span>
                <span class="tag">&lt;<span class="name">br</span>&gt;</span>
                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"number"</span> <span class="attr">name</span>=<span class="string">"authCode"</span> <span class="attr">id</span>=<span class="string">"authCode"</span><span class="attr">class</span>=<span class="string">"layui-input"</span> <span class="attr">placeholder</span>=<span class="string">"请输入验证码"</span>&gt;</span>
                <span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span>
                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"获取验证码"</span> <span class="attr">name</span>=<span class="string">"yzm"</span> <span class="attr">class</span>=<span class="string">"layui-btn layui-btn-radius layui-btn-warm"</span> <span class="attr">disabled</span>=<span class="string">"disabled"</span> <span class="attr">id</span>=<span class="string">"yzm"</span>&gt;</span>
                    <span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span>
                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"提交"</span> <span class="attr">name</span>=<span class="string">"nzm"</span> <span class="attr">class</span>=<span class="string">"layui-btn layui-btn-radius layui-btn-normal"</span> <span class="attr">id</span>=<span class="string">"nzm"</span>&gt;</span>
            <span class="tag">&lt;/<span class="name">div</span>&gt;</span>
        <span class="tag">&lt;/<span class="name">div</span>&gt;</span>
    <span class="tag">&lt;/<span class="name">div</span>&gt;</span>
<span class="tag">&lt;/<span class="name">div</span>&gt;</span>

<span class="tag">&lt;<span class="name">div</span>&gt;</span>

<span class="tag">&lt;/<span class="name">div</span>&gt;</span>
<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdn.jsdelivr.net/npm/jquery@3.2/dist/jquery.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>
<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdn.jsdelivr.net/semantic-ui/2.2.4/semantic.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>

</code></pre>
</li>
</ul>
  <script>
      $(document).ready(function(){
          var ordertime=20   //设置再次发送验证码等待时间
          var timeleft=ordertime
          var btn=$("#yzm")
          var stn=$("#nzm")
          var phone=$("#phone")
          var authCode=$("#authCode")
          var reg = /^1[0-9]{10}$/;  //电话号码的正则匹配式

          phone.keyup(function(){
              if (reg.test(phone.val())){
                  btn.removeAttr("disabled")  //当号码符合规则后发送验证码按钮可点击
              }
              else{
                  btn.attr("disabled",true)
              }
          })

          //计时函数
          function timeCount(){
              timeleft-=1
              if (timeleft>0){
                  btn.val(timeleft+" 秒后重发");
                  setTimeout(timeCount,1000)
              }
              else {
                  btn.val("重新发送");
                  timeleft=ordertime   //重置等待时间
                  btn.removeAttr("disabled");
              }
          }

          //事件处理函数
          btn.on("click",function(){
              $(this).attr("disabled",true); //防止多次点击
              $.ajax({
                  type: "GET", //用POST方式传输
                  url: '/admin/api/note/sendNote/'+phone.val(), //目标地址
                  error: function () { alert("验证码发送失败，请联系管理员")}, //请求错误时的处理函数
                  success: function (){ alert("已发送验证码到您的手机")}, //请求成功时执行的函数
              });
              timeCount(this);
          })

          stn.on("click",function(){
              $(this).attr("disabled",true); //防止多次点击
              $.ajax({
                  type: "GET", //用POST方式传输
                  url: '/admin/api/note/login/'+phone.val()+'/'+authCode.val(), //目标地址
                  error: function () { alert("登陆失败")

                  }, //请求错误时的处理函数
                  success: function (){ alert("登陆成功")
                      //window.location.href="../../admin/index.html";
                      window.location.href="http://localhost:8080/admin/blogs";
                  }, //请求成功时执行的函数
              });
              timeCount(this);
          })
      })
  </script>

  
  
  ```





<h2 id="16-服务器部署项目"><a href="#16-服务器部署项目" class="headerlink" title="16. 服务器部署项目"></a>16. 服务器部署项目</h2><ul>
<li>打开FinalShell连接云服务器</li>
<li>后台运行jar包  <code>nohup java -jar *****.jar &amp;</code></li>
<li>运行jar包所需要环境： <code>redis , mysql , Java 8</code></li>
<li>Nginx反向代理开启后便可访问域名</li>
<li><code>[Fhawke的博客](http://81.70.168.126:8080/)</code></li>
</ul>

            </article>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/%E9%A1%B9%E7%9B%AE/">项目</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/SpringBoot/">SpringBoot</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" target="_blank" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！</p>
              
              
                <div class="post-prevnext row">
                  <div class="post-prev col-6">
                    
                    
                      <a href="/2020/12/29/%E6%95%99%E8%82%B2%E5%B9%B3%E5%8F%B0%E5%BC%80%E5%8F%91%E6%89%80%E9%81%87%E9%97%AE%E9%A2%98/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">教育平台开发所遇问题</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </div>
                  <div class="post-next col-6">
                    
                    
                      <a href="/2020/12/27/CAP%E7%90%86%E8%AE%BA/">
                        <span class="hidden-mobile">CAP理论</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </div>
                </div>
              
            </div>

            
          </div>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;TOC</p>
  <div id="tocbot"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    
  </main>

  
    <a id="scroll-top-button" href="#" role="button">
      <i class="iconfont icon-arrowup" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  

  

  <footer class="mt-5">
  <div class="text-center py-3">
    <div>
      <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a>
      <i class="iconfont icon-love"></i>
      <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener">
        <span>Fluid</span></a>
    </div>
    

    

    
  </div>
</footer>

<!-- SCRIPTS -->
<script  src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/main.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>
  <script  src="/js/clipboard-use.js" ></script>







  <script  src="https://cdn.staticfile.org/tocbot/4.11.1/tocbot.min.js" ></script>
  <script>
    $(document).ready(function () {
      var boardCtn = $('#board-ctn');
      var boardTop = boardCtn.offset().top;

      tocbot.init({
        tocSelector: '#tocbot',
        contentSelector: 'article.markdown-body',
        headingSelector: 'h1,h2,h3,h4,h5,h6',
        linkClass: 'tocbot-link',
        activeLinkClass: 'tocbot-active-link',
        listClass: 'tocbot-list',
        isCollapsedClass: 'tocbot-is-collapsed',
        collapsibleClass: 'tocbot-is-collapsible',
        collapseDepth: 0,
        scrollSmooth: true,
        headingsOffset: -boardTop
      });
      if ($('.toc-list-item').length > 0) {
        $('#toc').css('visibility', 'visible');
      }
    });
  </script>



  <script  src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "博客系统开发过程&nbsp;",
      ],
      cursorChar: "_",
      typeSpeed: 70,
      loop: false,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script  src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      searchFunc(path, 'local-search-input', 'local-search-result');
      this.onclick = null
    }
  </script>



  <script  src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />

  <script>
    $('#post img:not(.no-zoom img, img[no-zoom]), img[zoom]').each(
      function () {
        var element = document.createElement('a');
        $(element).attr('data-fancybox', 'images');
        $(element).attr('href', $(this).attr('src'));
        $(this).wrap(element);
      }
    );
  </script>




















</body>
</html>
